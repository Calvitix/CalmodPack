
# Original File
#
# Calvitix Check 3.2  22.11.2021
#
# Merge with NSC  07.03.2022
# Modified by Calvitix 15.05.2021
# Merge with Starnet AI 24.11.2021
# Merge with Starnet AI for NSC 02.12.2021
# Merge with Starbase Upgrade  11.11.2021

#Calvitix Modifs - to change the values of module (less alloys,..)
#AI balance too
# possible section models:
# SHIPYARD_STARBASE_SECTION
# REFINERY_STARBASE_SECTION
# SCIENCE_STARBASE_SECTION
# HANGAR_STARBASE_SECTION
# ASSEMBLYYARD_STARBASE_SECTION
#

shipyard = {
	icon = "GFX_starbase_shipyard"
	section = "ASSEMBLYYARD_STARBASE_SECTION"
	construction_days = 180
	initial = yes

	resources = {
		category = starbase_modules
#Calvitix ressources balance
		cost = { 
			trigger = {
				from = {
					is_ai = no
				}
			}
			alloys = 40
			minerals = 50
			energy = 50
		}
		cost = {
			trigger = {
				from = {
					is_ai = yes
				}
			}
			alloys = 50
		}

		upkeep = {
			energy = 1
		}
	}

	station_modifier = {
		starbase_shipyard_capacity_add = 1
	}

	triggered_station_modifier = {
		potential = {
			exists = this
			has_starbase_building = drydock
		}
		starbase_shipyard_capacity_add = 1
	}

	ai_build_at_chokepoint = yes
	ai_build_outside_chokepoint = yes
	ai_weight = {
		weight = 30
		modifier = {
			factor = 100
			owner = {
				OR = {
					count_owned_starbase = {
						count = 0
						limit = { has_starbase_module = shipyard }
					}
					AND = {
						num_starbases >= 4
						count_owned_starbase = {
							count < 2
							limit = { has_starbase_module = shipyard }
						}
					}
					AND = {
						num_starbases >= 9
						count_owned_starbase = {
							count < 3
							limit = { has_starbase_module = shipyard }
						}
					}
					AND = {
						num_starbases >= 15
						count_owned_starbase = {
							count < 4
							limit = { has_starbase_module = shipyard }
						}
					}
				}
			}
		}
		modifier = {
			factor = 3
			has_starbase_module = shipyard
			count_starbase_modules = {
				count < 2
				type = shipyard
			}
		}
		modifier = {
			factor = 3
			has_starbase_module = shipyard
			count_starbase_modules = {
				count < 4
				type = shipyard
			}
		}
#Calvitix mod
		modifier = {
			factor = 0.5
			has_starbase_module = shipyard
			count_starbase_modules = {
				count > 3
				type = shipyard
			}
		}
		modifier = {
			factor = 0.5
			has_starbase_module = shipyard
			count_starbase_modules = {
				count > 4
				type = shipyard
			}
		}		
		modifier = {
			factor = 0
			has_starbase_module = shipyard
			count_starbase_modules = {
				count > 5
				type = shipyard
			}
		}
		modifier = {
			factor = 0
			not = { has_starbase_module = shipyard }
			owner = { needs_shipyard = no }
		}
		modifier = {
			factor = 0
			has_starbase_module = anchorage
			not = { has_starbase_module = shipyard }
		}
		modifier = {
			factor = 0
			has_starbase_module = orbital_lab
			not = { has_starbase_module = shipyard }
		}
	}
}


anchorage = {
	icon = "GFX_starbase_anchorage"
	section = "ANCHORAGE_STARBASE_SECTION"
	construction_days = 180

	resources = {
		category = starbase_modules
#Calvitix ressources balance
		cost = { 
			trigger = {
				from = {
					is_ai = no
				}
			}
			alloys = 50
			minerals = 50
			energy = 50
		}
		cost = {
			trigger = {
				from = {
					is_ai = yes
				}
			}
			alloys = 50
		}

		upkeep = {
			energy = 1
		}
	}

	country_modifier = {
		country_naval_cap_add = 10 # 15 # 4  #NSC #Calvitix change
	}

	triggered_country_modifier = {
		potential = { has_starbase_building = naval_logistics_office }
		country_naval_cap_add = 10 #2   #NSC #Calvitix change
	}

	ai_build_at_chokepoint = no
	ai_build_outside_chokepoint = yes
	ai_weight = {
##NSC
		weight = 150
		modifier = {
			factor = 4
			count_starbase_modules = {
				type = anchorage
				count < 1
			}
			count_starbase_modules = {
				type = shipyard
				count < 1
			}
		}		
###
		modifier = {
			factor = 2
			count_starbase_modules = {
				type = anchorage
				count < 2
			}
		}
#CALVITIX
		modifier = {
			factor = 0.2
			count_starbase_modules = {
				type = anchorage
				count > 4
			}
		}
		modifier = {
			factor = 0
			not = { has_starbase_module = anchorage }
			owner = { needs_shipyard = yes }
		}	
		modifier = {
			factor = 0
			has_starbase_module = shipyard
			count_starbase_modules = {
				type = shipyard
				count < 2
			}
		}
		modifier = {
			factor = 0
			owner = { used_naval_capacity_percent < 0.7 }
		}
		modifier = {
			factor = 0
			has_starbase_module = asteroid_mining
			years_passed < 70
			owner = { 
				resource_stockpile_compare = {
					resource = minerals
					value < 1000
				} 
			}
		}
###		
	}
}


gun_battery = {
	section = "BATTERY_STARBASE_SECTION"
	icon = GFX_spaceport_modules
	construction_days = 180

	resources = {
		category = starbase_modules
#Calvitix ressources balance
		cost = { 
			trigger = {
				from = {
					is_ai = no
				}
			}
			alloys = 50
			energy = 50
		}
		cost = {
			trigger = {
				from = {
					is_ai = yes
				}
			}
			alloys = 50
		}

		upkeep = {
			energy = 1
		}
	}

	station_modifier = {  #disabled by NSC (or Calvitix)
		ship_hull_mult = 0.10
		ship_armor_mult = 0.10
		#starbase_trade_protection_range_add = 1 #Calvitix change
		starbase_trade_protection_add = 5
	}

	ai_build_at_chokepoint = yes
	ai_build_outside_chokepoint = yes #Calvitix change
	ai_weight = {
		weight = 100 #20 #Calvitix change
		modifier = {
			factor = 2
			exists = owner
			owner = {
				OR = {
					is_preferred_weapons = weapon_type_energy
					is_preferred_weapons = weapon_type_kinetic
				}
			}
		}
#CALVITIX
		modifier = { factor = 0.9 count_starbase_modules = { type = gun_battery count > 0 } }
		modifier = { factor = 0.9 count_starbase_modules = { type = gun_battery count > 1 } }
		modifier = { factor = 0.9 count_starbase_modules = { type = gun_battery count > 2 } }
		modifier = { factor = 0.9 count_starbase_modules = { type = gun_battery count > 3 } }
		modifier = { factor = 0.9 count_starbase_modules = { type = gun_battery count > 4 } }
		modifier = { factor = 0.9 count_starbase_modules = { type = gun_battery count > 5 } }
		modifier = { factor = 0.9 count_starbase_modules = { type = gun_battery count > 6 } }
		modifier = { factor = 0.5 count_starbase_modules = { type = gun_battery count > 7 } }
		modifier = { factor = 0.5 has_starbase_size < starbase_starfortress }		
####
	}

	show_in_tech = "tech_mass_drivers_1"
}


missile_battery = {
	section = "MISSILE_STARBASE_SECTION"
	icon = "GFX_starbase_missile_battery"
	construction_days = 180

	resources = {
		category = starbase_modules
#Calvitix ressources balance
		cost = { 
			trigger = {
				from = {
					is_ai = no
				}
			}
			alloys = 50
			energy = 50
		}
		cost = {
			trigger = {
				from = {
					is_ai = yes
				}
			}
			alloys = 50
		}

		upkeep = {
			energy = 1
		}
	}

	station_modifier = {
		ship_hull_mult = 0.10
		ship_armor_mult = 0.10
#		starbase_trade_protection_range_add = 1 #Calvitix change
		starbase_trade_protection_add = 5
	}

	ai_build_at_chokepoint = yes
	ai_build_outside_chokepoint = yes #Calvitix change
	ai_weight = {
		weight = 100 #10 #Calvitix change
		modifier = {
			factor = 2
			exists = owner
			owner = { is_preferred_weapons = weapon_type_explosive }
		}
#CALVITIX
		modifier = { factor = 0.9 count_starbase_modules = { type = missile_battery count > 0 } }
		modifier = { factor = 0.9 count_starbase_modules = { type = missile_battery count > 1 } }
		modifier = { factor = 0.9 count_starbase_modules = { type = missile_battery count > 2 } }
		modifier = { factor = 0.9 count_starbase_modules = { type = missile_battery count > 3 } }
		modifier = { factor = 0.9 count_starbase_modules = { type = missile_battery count > 4 } }
		modifier = { factor = 0.9 count_starbase_modules = { type = missile_battery count > 5 } }
		modifier = { factor = 0.9 count_starbase_modules = { type = missile_battery count > 6 } }
		modifier = { factor = 0.5 count_starbase_modules = { type = missile_battery count > 7 } }		
		modifier = { factor = 0.5 has_starbase_size < starbase_starfortress }		
		
####
	}

	show_in_tech = "tech_missiles_1"
}


pd_battery = {
	section = "PD_STARBASE_SECTION"
	icon = "GFX_starbase_pd_battery"
	construction_days = 150
	
	resources = {
		category = starbase_modules
#Calvitix ressources balance
		cost = { 
			trigger = {
				from = {
					is_ai = no
				}
			}
			alloys = 50 
			energy = 50
		}
		cost = {
			trigger = {
				from = {
					is_ai = yes
				}
			}
			alloys = 50
		}

		upkeep = { energy = 1 }
	}
	
	station_modifier = { 
		starbase_trade_protection_add = 3
	}
	
	ai_build_at_chokepoint = yes
	ai_build_outside_chokepoint = yes #Calvitix change
	
	potential = { 
		exists = owner 
		owner = { 
			OR = {
				has_technology = tech_pd_tracking_1 
				has_technology = tech_pd_tracking_2
				has_technology = tech_pd_tracking_3 
				has_technology = tech_flak_batteries_1 
				has_technology = tech_flak_batteries_2
				has_technology = tech_flak_batteries_3
			}
		}
		has_starbase_size >= starbase_starport #not for outposts
	}
	
	ai_weight = {
		weight = 120
#CALVITIX
		modifier = { factor = 0.8 count_starbase_modules = { type = pd_battery count > 0 } }
		modifier = { factor = 0.8 count_starbase_modules = { type = pd_battery count > 1 } }
		modifier = { factor = 0.8 count_starbase_modules = { type = pd_battery count > 2 } }
		modifier = { factor = 0.8 count_starbase_modules = { type = pd_battery count > 3 } }
		modifier = { factor = 0.8 count_starbase_modules = { type = pd_battery count > 4 } }
		modifier = { factor = 0.8 count_starbase_modules = { type = pd_battery count > 5 } }
		modifier = { factor = 0.8 count_starbase_modules = { type = pd_battery count > 6 } }
		modifier = { factor = 0.5 count_starbase_modules = { type = pd_battery count > 7 } }				
####
		modifier = { factor = 0.9 has_starbase_size < starbase_starfortress }		
		#modifier = { factor = 0 count_starbase_modules = { type = pd_battery count = 2 } }
	}
}


large_battery = {
	section = "LARGE_STARBASE_SECTION"
	icon = "GFX_starbase_large_battery"
	construction_days = 240
	
	resources =	{
		category = starbase_modules
#Calvitix ressources balance
		cost = { 
			trigger = {
				from = {
					is_ai = no
				}
			}
			alloys = 125 
			energy = 50
		}
		cost = {
			trigger = {
				from = {
					is_ai = yes
				}
			}
			alloys = 125
		}

		upkeep = { energy = 2 } #1
	}
	
	station_modifier = { 
		ship_hull_mult = 0.10
		ship_armor_mult = 0.10
		starbase_trade_protection_range_add = 1
		starbase_trade_protection_add = 5
	}
	
	ai_build_at_chokepoint = yes
	ai_build_outside_chokepoint = yes #Calvitix change
	
	potential = { 
		has_starbase_size >= starbase_starfortress
	}
	
	ai_weight = {
		weight = 125
#CALVITIX
		modifier = {
			factor = 0.8
			count_starbase_modules = {
				type = large_battery
				count > 2
			}
		}
		modifier = {
			factor = 0.6
			count_starbase_modules = {
				type = large_battery
				count > 3
			}
		}
		modifier = {
			factor = 0.5
			count_starbase_modules = {
				type = large_battery
				count > 4
			}
		}			
####
		modifier = { factor = 0 has_starbase_size < starbase_starfortress }
		modifier = { factor = 0 count_starbase_modules = { type = large_battery count > 5 } }
	}	
}


hangar_bay = {
	icon = "GFX_starbase_hangar_bay"
	section = "HANGAR_STARBASE_SECTION"
	construction_days = 180

	potential = {
		exists = owner
		owner = { has_technology = tech_strike_craft_1 }
	}

##NSC
	possible = {
		custom_tooltip = {
			fail_text = "starbase_h_limit.tooltip.fail"
			count_starbase_modules = { count < 6 type = hangar_bay }
		}
	}
###

	resources = {
		category = starbase_modules
#Calvitix ressources balance
		cost = { 
			trigger = {
				from = {
					is_ai = no
				}
			}
			alloys = 30 
			minerals = 50
			influence = 10
			energy = 50
		}
		cost = {
			trigger = {
				from = {
					is_ai = yes
				}
			}
			alloys = 50
		}

		upkeep = { alloys = 1 energy = 1 } ##NSC
	}

	station_modifier = {
		ship_hull_mult = 0.10 #Calvitix change
		ship_armor_mult = 0.10
		starbase_trade_protection_range_add = 1
		starbase_trade_protection_add = 10
	}

	ai_build_at_chokepoint = yes
	ai_build_outside_chokepoint = yes
	ai_weight = {
		weight = 150 #30
		modifier = {
			factor = 3
			exists = owner
			owner = { is_preferred_weapons = weapon_type_strike_craft }
		}
#CALVITIX
		modifier = {
			factor = 0.6
			count_starbase_modules = {
				type = hangar_bay
				count > 1
			}
		}
		modifier = {
			factor = 0.5
			count_starbase_modules = {
				type = hangar_bay
				count > 2
			}
		}
		modifier = {
			factor = 0.5
			count_starbase_modules = {
				type = hangar_bay
				count > 3
			}
		}			
####
		modifier = {
			factor = 0
			count_starbase_modules = {
				type = hangar_bay
				count >= 5 
			}
		}
	}

	show_in_tech = "tech_strike_craft_1"
}


xl_battery = {
	section = "EXTRA_LARGE_STARBASE_SECTION"
	icon = "GFX_starbase_xl_battery"
	construction_days = 320
	
	resources = {
		category = starbase_modules
#Calvitix ressources balance
		cost = { 
			trigger = {
				from = {
					is_ai = no
				}
			}
			alloys = 200 
			energy = 100
			minerals = 50
		}
		cost = {
			trigger = {
				from = {
					is_ai = yes
				}
			}
			alloys = 300
		}
		upkeep = { alloys = 1 energy = 3 }
	}
	
	station_modifier = {
		starbase_trade_protection_range_add = 1
		starbase_trade_protection_add = 5
	}
	
	ai_build_at_chokepoint = yes
	ai_build_outside_chokepoint = no

	potential = { 
		exists = owner 
		owner = { 
			OR = {
				has_technology = tech_energy_lance_1 
				has_technology = tech_energy_lance_2 
				has_technology = tech_arc_emitter_1 
				has_technology = tech_arc_emitter_2 
				has_technology = tech_mass_accelerator_1
				has_technology = tech_mass_accelerator_2 
			}
		}
		has_starbase_size >= starbase_citadel

	}
	
	possible = {
		custom_tooltip = {
			fail_text = "starbase_xl_limit.tooltip.fail"
			count_starbase_modules = { count < 6 type = xl_battery }
		}
	}

	ai_weight = {
		weight = 180 #50
#CALVITIX
		modifier = {
			factor = 0.6
			count_starbase_modules = {
				type = xl_battery
				count > 1
			}
		}
		modifier = {
			factor = 0.5
			count_starbase_modules = {
				type = xl_battery
				count > 2
			}
		}
		modifier = {
			factor = 0.5
			count_starbase_modules = {
				type = xl_battery
				count > 3
			}
		}			
####		
	}
}


titanic_battery = {
	section = "TITANIC_STARBASE_SECTION"
	icon = "GFX_starbase_titanic_battery"
	construction_days = 420

	resources = {
		category = starbase_modules
#Calvitix ressources balance
		cost = { 
			trigger = {
				from = {
					is_ai = no
				}
			}
			alloys = 300
			energy = 150
			minerals = 200
		}
		cost = {
			trigger = {
				from = {
					is_ai = yes
				}
			}
			alloys = 750
		}

		upkeep = { alloys = 3 energy = 5 }
	}

	station_modifier = { 
		starbase_trade_protection_range_add = 2
		starbase_trade_protection_add = 7
	}

	ai_build_at_chokepoint = yes
	ai_build_outside_chokepoint = no

	potential = { 
		exists = owner owner = { has_technology = tech_titans }
		has_starbase_size >= starbase_citadel
	}

	possible = {
		custom_tooltip = {
			fail_text = "starbase_t_limit.tooltip.fail"
			count_starbase_modules = { count < 2 type = titanic_battery }
		}
	}

	ai_weight = {
		weight = 180
#CALVITIX
		modifier = {
			factor = 0.6
			count_starbase_modules = {
				type = titanic_battery
				count > 1
			}
		}
		modifier = {
			factor = 0.5
			count_starbase_modules = {
				type = titanic_battery
				count > 2
			}
		}
		modifier = {
			factor = 0.5
			count_starbase_modules = {
				type = titanic_battery
				count > 3
			}
		}			
####		
	}

	show_in_tech = "tech_titans"
}


shield_module = {
	section = "ANCHORAGE_STARBASE_SECTION"
	icon = "GFX_starbase_shield_module"
	construction_days = 180
	resources = {
		category = starbase_modules
#Calvitix ressources balance
		cost = { 
			trigger = {
				from = {
					is_ai = no
				}
			}
			alloys = 50 
			energy = 150
			minerals = 50
		}
		cost = {
			trigger = {
				from = {
					is_ai = yes
				}
			}
			alloys = 75
		}

		upkeep = { energy = 2 } #1
	}
	station_modifier = { 
		ship_shield_add = 3000
		ship_shield_regen_add_perc = 1
	}
	ai_build_at_chokepoint = yes
	ai_build_outside_chokepoint = yes
	potential = { 
		has_starbase_size >= starbase_starport #not for outposts
		solar_system = { NOT = { is_star_class = sc_pulsar } } #not for Pulsar Systems
	}
	ai_weight = {
		weight = 125 #0
#CALVITIX
		modifier = { factor = 0.75 count_starbase_modules = { type = shield_module count > 0 } }
		modifier = { factor = 0.75 count_starbase_modules = { type = shield_module count > 1 } }
		modifier = { factor = 0.9 count_starbase_modules = { type = shield_module count > 2 } }
		modifier = { factor = 0.9 count_starbase_modules = { type = shield_module count > 3 } }
		modifier = { factor = 0.9 count_starbase_modules = { type = shield_module count > 4 } }
		modifier = { factor = 0.9 count_starbase_modules = { type = shield_module count > 5 } }
		modifier = { factor = 0.5 has_starbase_size < starbase_starfortress }		
		
####		
		modifier = { factor = 0.5 count_starbase_modules = { type = shield_module count > 10 } }
		modifier = { factor = 0 count_starbase_modules = { type = shield_module count >= 15 } }
	}
}


armor_module = {
	section = "ANCHORAGE_STARBASE_SECTION"
	icon = "GFX_starbase_armor_module"
	construction_days = 180
	resources = {
		category = starbase_modules
#Calvitix ressources balance
		cost = { 
			trigger = {
				from = {
					is_ai = no
				}
			}
			alloys = 70
			energy = 20
			minerals = 50
		}
		cost = {
			trigger = {
				from = {
					is_ai = yes
				}
			}
			alloys = 75
		}

		upkeep = { alloys = 1 }
	}
	station_modifier = { 
		ship_armor_add = 3000
		ship_armor_regen_add_perc = 1
	}
	ai_build_at_chokepoint = yes
	ai_build_outside_chokepoint = yes
	potential = {
		has_starbase_size >= starbase_starport #not for outposts
	}
	ai_weight = {
		weight = 130 #0
#CALVITIX
		modifier = { factor = 0.75 count_starbase_modules = { type = armor_module count > 0 } }
		modifier = { factor = 0.75 count_starbase_modules = { type = armor_module count > 1 } }
		modifier = { factor = 0.9 count_starbase_modules = { type = armor_module count > 2 } }
		modifier = { factor = 0.9 count_starbase_modules = { type = armor_module count > 3 } }
		modifier = { factor = 0.9 count_starbase_modules = { type = armor_module count > 4 } }
		modifier = { factor = 0.9 count_starbase_modules = { type = armor_module count > 5 } }
####
		modifier = { factor = 0.5 count_starbase_modules = { type = armor_module count > 10 } }
		modifier = { factor = 0 count_starbase_modules = { type = armor_module count >= 15 } }
	}
}


solar_panel_network = {
	icon = "GFX_solar_panel_network"
	section = "SCIENCE_STARBASE_SECTION"
	construction_days = 180
	initial = yes

	potential = {
		exists = owner
		owner = {
			is_gestalt = yes
			has_technology = "tech_solar_panel_network"
		}
	}

	possible = {
		solar_system = {
			custom_tooltip = {
				fail_text = "requires_no_black_hole_or_dyson_sphere"
				NOR = {
					is_star_class = sc_black_hole
					has_megastructure = dyson_sphere_3
					has_megastructure = dyson_sphere_4
					has_megastructure = dyson_sphere_5
				}
			}
		}
	}

	show_in_tech = "tech_solar_panel_network"

	resources = {
		category = starbase_modules
#Calvitix ressources balance
		cost = { 
			trigger = {
				from = {
					is_ai = no
				}
			}
			alloys = 40
			energy = 50
			minerals = 20
		}
		cost = {
			trigger = {
				from = {
					is_ai = yes
				}
			}
			alloys = 50
		}

		produces = {
			energy = 6 #3
		}

		produces = {
			trigger = {
				exists = owner
				owner = {
					is_galactic_community_member = yes
				}
				OR = {
					is_active_resolution = "resolution_galacticstudies_astral_studies_network"
					is_active_resolution = "resolution_galacticstudies_advanced_xenostudies"
					is_active_resolution = "resolution_galacticstudies_ethical_guideline_refactoring"
					is_active_resolution = "resolution_galacticstudies_extradimensional_experimentation"
				}
			}
			energy = 6 #3
		}
	}

	ai_build_at_chokepoint = no
	ai_weight = {
		weight = 100 #15
#CALVITIX
		modifier = {
			factor = 0.9
			count_starbase_modules = {
				type = solar_panel_network
				count > 1
			}
		}
		modifier = {
			factor = 0.8
			count_starbase_modules = {
				type = solar_panel_network
				count > 2			}
		}
		modifier = {
			factor = 0.9
			count_starbase_modules = {
				type = solar_panel_network
				count > 3
			}
		}			
		modifier = { factor = 0.5 has_starbase_size < starbase_starport }		
####		
	}
}


trading_hub = {
	icon = "GFX_starbase_trading_hub"
	section = "REFINERY_STARBASE_SECTION"
	construction_days = 180
	initial = yes

	potential = {
		exists = owner
		owner = {
			is_gestalt = no
		}
	}

	resources = {
		category = starbase_modules
#Calvitix ressources balance
		cost = { 
			trigger = {
				from = {
					is_ai = no
				}
			}
			alloys = 40
			energy = 50
			influence = 10
		}
		cost = {
			trigger = {
				from = {
					is_ai = yes
				}
			}
			alloys = 50
		}
		upkeep = {
			energy = 1
		}
	}

	station_modifier = {
		starbase_trade_collection_range_add = 1
	}

	ai_build_at_chokepoint = no
	ai_weight = {
		weight = 100 #15
		modifier = {
			factor = 5
			NOT = { has_starbase_module = trading_hub }
			solar_system = {
				any_neighbor_system = {
					has_system_trade_value > 50
				}
			}
		}
	}
}


space_power_plant = {
	section = "ANCHORAGE_STARBASE_SECTION"
	icon = "GFX_starbase_space_power_plant"
	construction_days = 120
	resources = {
		category = starbase_modules
#Calvitix ressources balance
		cost = { 
			trigger = {
				from = {
					is_ai = no
				}
			}
			alloys = 40
			minerals = 200
			energy = 50
		}
		cost = {
			trigger = {
				from = {
					is_ai = yes
				}
			}
			alloys = 60
		}

		produces = { energy = 5 }
		upkeep = { minerals = 2 }
	}
	ai_build_at_chokepoint = no
	ai_build_outside_chokepoint = yes
	ai_weight = {
#Calvitix
		weight = 50
		modifier = { factor = 5 has_starbase_size < starbase_starport }
		modifier = { factor = 4 count_starbase_modules = { type = space_power_plant count > 1 } }
		modifier = { factor = 3 count_starbase_modules = { type = space_power_plant count > 2 } }
		modifier = { factor = 2 count_starbase_modules = { type = space_power_plant count > 3 } }
		modifier = { factor = 1 count_starbase_modules = { type = space_power_plant count > 4 } }
		modifier = { factor = 0 count_starbase_modules = { type = space_power_plant count > 5 } }
###
#Starnet AI NSC
		modifier = {
			factor = 0
			not = { has_starbase_module = orbital_lab }
			owner = { needs_shipyard = yes }
		}	
		modifier = {
			factor = 0
			has_starbase_module = shipyard
			count_starbase_modules = {
				type = shipyard
				count < 2
			}
		}
		modifier = {
			factor = 0
			owner = { used_naval_capacity_percent > 0.65 }
			not = { has_starbase_module = space_power_plant }
		}
		modifier = {
			factor = 0
			has_starbase_module = asteroid_mining
			years_passed < 70
		}
###		
	}
}

asteroid_mining = {
	section = "ANCHORAGE_STARBASE_SECTION"
	icon = "GFX_starbase_asteroid_mining"
	construction_days = 120
	resources =	{
		category = starbase_modules
#Calvitix ressources balance
		cost = { 
			trigger = {
				from = {
					is_ai = no
				}
			}
			alloys = 40 
			energy = 50
			minerals = 50
		}
		cost = {
			trigger = {
				from = {
					is_ai = yes
				}
			}
			alloys = 50
		}

		produces = { minerals = 8 } #10
		produces = { trigger = { has_starbase_building = mining_experts } minerals = 2 }
		upkeep = { energy = 2 }
	}
	possible = { 
		custom_tooltip = { 
			fail_text = "nsc.requires.asteroid" 
			solar_system = { any_system_planet = { is_asteroid = yes }	} 
		}
##Calvitix Balance
		custom_tooltip = {
			fail_text = "starbase_h_limit.tooltip.fail"
			count_starbase_modules = { count < 4 type = asteroid_mining }
		}
	}
###	
	ai_build_at_chokepoint = yes
	ai_build_outside_chokepoint = yes
	ai_weight = {
		weight = 75 #50, 800 in Starnet NSC
#Calvitix		
		modifier = { factor = 5 has_starbase_size < starbase_starport }
		modifier = { 
			factor = 500 
			owner = { resource_income_compare = {	resource = minerals	value < 30	} }
			owner = { resource_stockpile_compare = {	resource = minerals	value < 1000 } }
		}
		modifier = { factor = 4 count_starbase_modules = { type = asteroid_mining count > 1 } }
		modifier = { factor = 3 count_starbase_modules = { type = asteroid_mining count > 2 } }
		modifier = { factor = 2 count_starbase_modules = { type = asteroid_mining count > 3 } }
		modifier = { factor = 1 count_starbase_modules = { type = asteroid_mining count > 4 } }
		modifier = { factor = 0 count_starbase_modules = { type = asteroid_mining count > 5 } }
		modifier = {
			factor = 0
			or = { 
			years_passed > 60
			owner = { 
			resource_stockpile_compare = {
				resource = minerals
				value > 2500
			} }
			owner = { 
			resource_income_compare = {
				resource = minerals
				value > 150
				} }
			}
		}
	}
}

orbital_lab = { #Disabled in last NSC Version, but keeped by Calvitix
	section = "ANCHORAGE_STARBASE_SECTION"
	icon = "GFX_starbase_starbase_lab"
	construction_days = 120
	resources = {
		category = starbase_modules
#Calvitix ressources balance
		cost = { 
			trigger = {
				from = {
					is_ai = no
				}
			}
			alloys = 40 
			energy = 150
			minerals = 50
		}
		cost = {
			trigger = {
				from = {
					is_ai = yes
				}
			}
			alloys = 50
		}

		produces = { physics_research = 4 society_research = 4 engineering_research = 4 }
		produces = { trigger = { has_starbase_building = orbital_physics_support_lab } physics_research = 2 }
		produces = { trigger = { has_starbase_building = orbital_society_support_lab } society_research = 2 }
		produces = { trigger = { has_starbase_building = orbital_engineering_support_lab } engineering_research = 2 }
		upkeep = { energy = 4 alloys = 1 }
	}	
	ai_build_at_chokepoint = yes
	ai_build_outside_chokepoint = yes
	ai_weight = {
		weight = 300
#CALVITIX
		modifier = { factor = 4	owner = { has_monthly_income = { resource = physics_research value < 35 } } }
		modifier = { factor = 0.75 count_starbase_modules = { type = orbital_lab count > 0 } }
		modifier = { factor = 0.75 count_starbase_modules = { type = orbital_lab count > 1 } }
		modifier = { factor = 0.9 count_starbase_modules = { type = orbital_lab count > 2 } }
		modifier = { factor = 0.9 count_starbase_modules = { type = orbital_lab count > 3 } }
		modifier = { factor = 0.9 count_starbase_modules = { type = orbital_lab count > 4 } }
		modifier = { factor = 0.9 count_starbase_modules = { type = orbital_lab count > 5 } }
		modifier = { factor = 0.9 count_starbase_modules = { type = orbital_lab count > 6 } }
		modifier = { factor = 0.5 count_starbase_modules = { type = orbital_lab count > 7 } }
####
		modifier = {
			factor = 0
			not = { has_starbase_module = orbital_lab }
			owner = { needs_shipyard = yes }
		}	
		modifier = {
			factor = 0
			has_starbase_module = shipyard
			count_starbase_modules = {
				type = shipyard
				count < 2
			}
		}
		modifier = {
			factor = 0
			owner = { used_naval_capacity_percent > 0.65 }
			not = { has_starbase_module = orbital_lab }
		}
		modifier = {
			factor = 0
			has_starbase_module = asteroid_mining
			years_passed < 70
		}
	}
}

space_foundry = {
	section = "ANCHORAGE_STARBASE_SECTION"
	icon = "GFX_starbase_space_foundry"
	construction_days = 120
	resources = {
		category = starbase_modules
#Calvitix ressources balance
		cost = { 
			trigger = {
				from = {
					is_ai = no
				}
			}
			alloys = 70 
			energy = 50
			minerals = 100
		}
		cost = {
			trigger = {
				from = {
					is_ai = yes
				}
			}
			alloys = 75
		}
		produces = { alloys = 6 }
		produces = { trigger = { has_starbase_building = chain_manufacturing } alloys = 1 }
		upkeep = { minerals = 10 energy = 2 }
	}	
	ai_build_at_chokepoint = yes
	ai_build_outside_chokepoint = yes
	potential = { exists = owner owner = { has_technology = tech_alloys_1 } }
	
	ai_weight = {
		weight = 80 #50
		modifier = { factor = 5 has_starbase_size <= starbase_starfortress }
		modifier = { factor = 4 count_starbase_modules = { type = space_foundry count > 1 } }
		modifier = { factor = 3 count_starbase_modules = { type = space_foundry count > 2 } }
		modifier = { factor = 2 count_starbase_modules = { type = space_foundry count > 3 } }
		modifier = { factor = 1 count_starbase_modules = { type = space_foundry count > 4 } }
		modifier = { factor = 0 count_starbase_modules = { type = space_foundry count > 5 } }
		modifier = {
			factor = 0
			nor = {
				owner = {
				resource_stockpile_compare = {
					resource = minerals
					value < 200
				} }
				owner = {
				resource_income_compare = {
					resource = minerals
					value < 30
				} }
				solar_system = {
					any_system_planet = {
						or = {
							has_designation = col_ecu_factory
							has_designation = col_ecu_foundry
							has_designation = col_foundry
							has_designation = col_factory
							has_designation = col_mac_factory
						}
					}
				}
			}
		}
	}
	show_in_tech = "tech_alloys_1"
}

space_factory = {
	section = "ANCHORAGE_STARBASE_SECTION"
	icon = "GFX_starbase_space_factory"
	construction_days = 120
	resources = {
		category = starbase_modules
#Calvitix ressources balance
		cost = { 
			trigger = {
				from = {
					is_ai = no
				}
			}
			alloys = 40 
			energy = 50
			minerals = 100
		}
		cost = {
			trigger = {
				from = {
					is_ai = yes
				}
			}
			alloys = 75
		}
		produces = { consumer_goods = 6 }
		produces = { trigger = { has_starbase_building = chain_manufacturing } consumer_goods = 2 }
		upkeep = { minerals = 6 energy = 2 }
	}	
	ai_build_at_chokepoint = no
	ai_build_outside_chokepoint = yes
	potential = {
		exists = owner 
		owner = { has_technology = tech_luxuries_1 } 
	}
	ai_weight = {
		weight = 70 #50
		modifier = { factor = 5 has_starbase_size < starbase_starfortress }
		modifier = { factor = 4 count_starbase_modules = { type = space_factory count > 1 } }
		modifier = { factor = 3 count_starbase_modules = { type = space_factory count > 2 } }
		modifier = { factor = 2 count_starbase_modules = { type = space_factory count > 3 } }
		modifier = { factor = 1 count_starbase_modules = { type = space_factory count > 4 } }
		modifier = { factor = 0 count_starbase_modules = { type = space_factory count > 5 } }
	}
	show_in_tech = "tech_luxuries_1"
}

security_branch_office = {
	section = "ANCHORAGE_STARBASE_SECTION"
	icon = "GFX_starbase_security_branch_office"
	construction_days = 120
	resources = {
		category = starbase_modules
#Calvitix ressources balance
		cost = { 
			trigger = {
				from = {
					is_ai = no
				}
			}
			alloys = 30 
			energy = 50
			minerals = 50
			influence = 20
		}
		cost = {
			trigger = {
				from = {
					is_ai = yes
				}
			}
			alloys = 50
		}

		upkeep = { energy = 1 }
	}	
	station_modifier = { starbase_trade_protection_add = 25 starbase_trade_protection_range_add = 2 }
	system_modifier = { planet_crime_add = -15 }
	ai_build_at_chokepoint = no
	ai_build_outside_chokepoint = yes
	ai_weight = {
		weight = 50
		modifier = { factor = 0.2 count_starbase_modules = { type = security_branch_office count > 0 } }
	}
}


#################
#Starbase Upgrade mod rework#
#################

heavy_gun_battery = {
	section = "HEAVY_BATTERY_STARBASE_SECTION"
	icon = "GFX_starbase_heavy_gun_battery"
	construction_days = 320
	
	potential = {
		exists = owner
		owner = { has_ascension_perk  = ap_eternal_vigilance  }
	}

	possible = {
		custom_tooltip = {
			fail_text = "requires_starfortress"
			has_starbase_size >= starbase_starfortress
		}
		custom_tooltip = {
			fail_text = "starbase_heavy_gun_battery_limit.tooltip.fail"
			count_starbase_modules = { count < 3 type = heavy_gun_battery }
		}
	}	

	

	resources = {
		category = starbase_modules
#Calvitix ressources balance
		cost = { 
			trigger = {
				from = {
					is_ai = no
				}
			}
			alloys = 200
			minerals = 50
			energy = 100
		}
		cost = {
			trigger = {
				from = {
					is_ai = yes
				}
			}
			alloys = 400
		}


		upkeep = {
			energy = 5
		}
	}

	station_modifier = {
		ship_hull_mult = 0.20
		ship_armor_mult = 0.15
		ship_shield_mult = 0.15
		starbase_trade_protection_range_add = 2
		starbase_trade_protection_add = 8
	}

	ai_build_at_chokepoint = yes
	ai_build_outside_chokepoint = no
	ai_weight = {
		weight = 130
		modifier = {
			factor = 2
			exists = owner
			owner = {
				OR = {
					is_preferred_weapons = weapon_type_energy
					is_preferred_weapons = weapon_type_kinetic
				}
			}
		}
#CALVITIX
		modifier = { factor = 0.8 count_starbase_modules = { type = heavy_gun_battery count > 0 } }
		modifier = { factor = 0.8 count_starbase_modules = { type = heavy_gun_battery count > 1 } }
		modifier = { factor = 0.8 count_starbase_modules = { type = heavy_gun_battery count > 2 } }
####
		
	}
}

heavy_missile_battery = {
	section = "HEAVY_MISSILE_STARBASE_SECTION"
	icon = "GFX_starbase_heavy_missile_battery"
	construction_days = 320
	
	potential = {
		exists = owner
		owner = { has_ascension_perk  = ap_eternal_vigilance  }
	}

	possible = {
		custom_tooltip = {
			fail_text = "requires_starfortress"
			has_starbase_size >= starbase_starfortress
		}
		custom_tooltip = {
			fail_text = "starbase_heavy_missile_battery_limit.tooltip.fail"
			count_starbase_modules = { count < 3 type = heavy_missile_battery }
		}
	}	

	resources = {
		category = starbase_modules
#Calvitix ressources balance
		cost = { 
			trigger = {
				from = {
					is_ai = no
				}
			}
			alloys = 200
			minerals = 50
			energy = 100
		}
		cost = {
			trigger = {
				from = {
					is_ai = yes
				}
			}
			alloys = 400
		}

		upkeep = {
			energy = 8
		}
	}

	station_modifier = {
		ship_hull_mult = 0.20
		ship_armor_mult = 0.15
		ship_shield_mult = 0.15
		starbase_trade_protection_range_add = 2
		starbase_trade_protection_add = 8
	}

	ai_build_at_chokepoint = yes
	ai_build_outside_chokepoint = no
	ai_weight = {
		weight = 130
		modifier = {
			factor = 2
			exists = owner
			owner = { is_preferred_weapons = weapon_type_explosive }
		}
#CALVITIX
		modifier = { factor = 0.8 count_starbase_modules = { type = heavy_missile_battery count > 0 } }
		modifier = { factor = 0.8 count_starbase_modules = { type = heavy_missile_battery count > 1 } }
		modifier = { factor = 0.8 count_starbase_modules = { type = heavy_missile_battery count > 2 } }
####
		
	}
}

heavy_hangar_bay = {
	section = "HEAVY_HANGAR_STARBASE_SECTION"
	icon = "GFX_starbase_heavy_hangar_bay"
	construction_days = 320

	potential = {
		exists = owner
		owner = { 
			has_technology = tech_strike_craft_1 
			has_ascension_perk = ap_eternal_vigilance
		}
	}
	
	possible = {
		custom_tooltip = {
			fail_text = "requires_starfortress"
			has_starbase_size >= starbase_starfortress
		}
		custom_tooltip = {
			fail_text = "starbase_heavy_hangar_bay_limit.tooltip.fail"
			count_starbase_modules = { count < 3 type = heavy_hangar_bay }
		}
	}	

	resources = {
		category = starbase_modules
#Calvitix ressources balance
		cost = { 
			trigger = {
				from = {
					is_ai = no
				}
			}
			alloys = 200
			minerals = 50
			energy = 100
		}
		cost = {
			trigger = {
				from = {
					is_ai = yes
				}
			}
			alloys = 400
		}


		upkeep = {
			energy = 7
		}
	}

	station_modifier = {
		ship_hull_mult = 0.20
		ship_armor_mult = 0.15
		ship_shield_mult = 0.15
		starbase_trade_protection_range_add = 2
		starbase_trade_protection_add = 15
	}

	ai_build_at_chokepoint = yes
	ai_build_outside_chokepoint = yes
	ai_weight = {
		weight = 130
		modifier = {
			factor = 2
			exists = owner
			owner = { is_preferred_weapons = weapon_type_strike_craft }
		}
#CALVITIX
		modifier = { factor = 0.8 count_starbase_modules = { type = heavy_hangar_bay count > 0 } }
		modifier = { factor = 0.8 count_starbase_modules = { type = heavy_hangar_bay count > 1 } }
		modifier = { factor = 0.8 count_starbase_modules = { type = heavy_hangar_bay count > 2 } }
		modifier = { factor = 0.8 count_starbase_modules = { type = heavy_hangar_bay count > 3 } }
		modifier = { factor = 0.8 count_starbase_modules = { type = heavy_hangar_bay count > 4 } }
		modifier = { factor = 0.8 count_starbase_modules = { type = heavy_hangar_bay count > 5 } }
		modifier = { factor = 0.8 count_starbase_modules = { type = heavy_hangar_bay count > 6 } }
		modifier = { factor = 0.5 count_starbase_modules = { type = heavy_hangar_bay count > 7 } }				
####
		
	}
}

heavy_x_gun_battery = {
	section = "HEAVY_X_BATTERY_STARBASE_SECTION"
	icon = "GFX_starbase_heavy_x_gun_battery"
	construction_days = 440
	
	potential = {
		exists = owner
		owner = { has_ascension_perk  = ap_eternal_vigilance  }
	}
	
	possible = {
		custom_tooltip = {
			fail_text = "requires_citadel"
			has_starbase_size >= starbase_citadel
		}
		custom_tooltip = {
			fail_text = "starbase_heavy_x_gun_battery_limit.tooltip.fail"
			count_starbase_modules = { count < 2 type = heavy_x_gun_battery }
		}
	}

	resources = {
		category = starbase_modules
#Calvitix ressources balance
		cost = { 
			trigger = {
				from = {
					is_ai = no
				}
			}
			alloys = 250
			minerals = 50
			energy = 100
		}
		cost = {
			trigger = {
				from = {
					is_ai = yes
				}
			}
			alloys = 500
		}

		upkeep = {
			energy = 10
		}
	}

	station_modifier = {
		ship_hull_mult = 0.20
		ship_armor_mult = 0.15
		ship_shield_mult = 0.15
		starbase_trade_protection_range_add = 2
		starbase_trade_protection_add = 8
	}

	ai_build_at_chokepoint = yes
	ai_build_outside_chokepoint = no
	ai_weight = {
		weight = 150
		modifier = {
			factor = 2
			exists = owner
			owner = {
				OR = {
					is_preferred_weapons = weapon_type_energy
					is_preferred_weapons = weapon_type_kinetic
				}
			}
		}
#CALVITIX
		modifier = { factor = 0.8 count_starbase_modules = { type = heavy_x_gun_battery count > 0 } }
		modifier = { factor = 0.8 count_starbase_modules = { type = heavy_x_gun_battery count > 1 } }
		modifier = { factor = 0.8 count_starbase_modules = { type = heavy_x_gun_battery count > 2 } }
		modifier = { factor = 0.8 count_starbase_modules = { type = heavy_x_gun_battery count > 3 } }
		modifier = { factor = 0.8 count_starbase_modules = { type = heavy_x_gun_battery count > 4 } }
		modifier = { factor = 0.8 count_starbase_modules = { type = heavy_x_gun_battery count > 5 } }
		modifier = { factor = 0.8 count_starbase_modules = { type = heavy_x_gun_battery count > 6 } }
		modifier = { factor = 0.5 count_starbase_modules = { type = heavy_x_gun_battery count > 7 } }				
####
		
	}
}