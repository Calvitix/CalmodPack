nsc_flagship_creation_effect = {
	random_owned_megastructure = {
		limit = { is_megastructure_type = nsc_flagship_complete }
		save_event_target_as = nsc_flagship_spawn_location
	}
	create_fleet = {
		effect = {
			set_owner = root
			create_ship = {
				name = random
				random_existing_design = Flagship
				graphical_culture = root
			}
			set_location = event_target:nsc_flagship_spawn_location
		}
	}
}
nsc_flagship_creation_for_ai_effect = {
	if = {
		limit = { NOT = { has_technology = tech_bh_power_3 } }
		give_technology = { tech = tech_bh_power_3 message = no }
	}
	if = {
		limit = { NOT = { has_technology = tech_Flagship_1 } }
		give_technology = { tech = tech_Flagship_1 message = no }
	}
	create_fleet = {
		effect = {
			set_owner = prev
			create_ship = {
				name = random
				random_existing_design = Flagship
				graphical_culture = prev
			}
			set_location = prev.capital_scope.starbase
		}
	}
}
nsc_federation_flagship_project_effect = {
	federation = {
		while = {
			count = 6
			root = { change_variable = { which = nsc_federation_flagship_project_target_count value = 1 } }
			random_member = {
				limit = {
					NOR = {
						is_same_empire = root
						has_special_project = NSC_FLAGSHIP_BUILDING_FEDERATION_PROJECT_1
						has_special_project = NSC_FLAGSHIP_BUILDING_FEDERATION_PROJECT_2
						has_special_project = NSC_FLAGSHIP_BUILDING_FEDERATION_PROJECT_3
						has_special_project = NSC_FLAGSHIP_BUILDING_FEDERATION_PROJECT_4
						has_special_project = NSC_FLAGSHIP_BUILDING_FEDERATION_PROJECT_5
						has_special_project = NSC_FLAGSHIP_BUILDING_FEDERATION_PROJECT_6
					}
				}
				if = {
					limit = { root = { check_variable = { which = nsc_federation_flagship_project_target_count value = 1 } } }
					enable_special_project = { name = NSC_FLAGSHIP_BUILDING_FEDERATION_PROJECT_1 location = this.capital_scope }
					add_modifier = { modifier = nsc_federation_flagship_project days = -1 } #1 budget modifier per 1 project
				}
				if = {
					limit = { root = { check_variable = { which = nsc_federation_flagship_project_target_count value = 2 } } }
					enable_special_project = { name = NSC_FLAGSHIP_BUILDING_FEDERATION_PROJECT_2 location = this.capital_scope }
					add_modifier = { modifier = nsc_federation_flagship_project days = -1 }
				}
				if = {
					limit = { root = { check_variable = { which = nsc_federation_flagship_project_target_count value = 3 } } }
					enable_special_project = { name = NSC_FLAGSHIP_BUILDING_FEDERATION_PROJECT_3 location = this.capital_scope }
					add_modifier = { modifier = nsc_federation_flagship_project days = -1 }
				}
				if = {
					limit = { root = { check_variable = { which = nsc_federation_flagship_project_target_count value = 4 } } }
					enable_special_project = { name = NSC_FLAGSHIP_BUILDING_FEDERATION_PROJECT_4 location = this.capital_scope }
					add_modifier = { modifier = nsc_federation_flagship_project days = -1 }
				}
				if = {
					limit = { root = { check_variable = { which = nsc_federation_flagship_project_target_count value = 5 } } }
					enable_special_project = { name = NSC_FLAGSHIP_BUILDING_FEDERATION_PROJECT_5 location = this.capital_scope }
					add_modifier = { modifier = nsc_federation_flagship_project days = -1 }
				}
				if = {
					limit = { root = { check_variable = { which = nsc_federation_flagship_project_target_count value = 6 } } }
					enable_special_project = { name = NSC_FLAGSHIP_BUILDING_FEDERATION_PROJECT_6 location = this.capital_scope }
					add_modifier = { modifier = nsc_federation_flagship_project days = -1 }
				}
			}
		}
		if = { #I'm not sure if '1 member federation' is possible, but just in case...
			limit = { NOT = { any_member = { has_special_project = NSC_FLAGSHIP_BUILDING_FEDERATION_PROJECT_1 } } }
			root = { enable_special_project = { name = NSC_FLAGSHIP_BUILDING_FEDERATION_PROJECT_1 location = root.capital_scope } }
		}
		if = {
			limit = { NOT = { any_member = { has_special_project = NSC_FLAGSHIP_BUILDING_FEDERATION_PROJECT_2 } } }
			root = { enable_special_project = { name = NSC_FLAGSHIP_BUILDING_FEDERATION_PROJECT_2 location = root.capital_scope } }
		}
		if = {
			limit = { NOT = { any_member = { has_special_project = NSC_FLAGSHIP_BUILDING_FEDERATION_PROJECT_3 } } }
			root = { enable_special_project = { name = NSC_FLAGSHIP_BUILDING_FEDERATION_PROJECT_3 location = root.capital_scope } }
		}
		if = {
			limit = { NOT = { any_member = { has_special_project = NSC_FLAGSHIP_BUILDING_FEDERATION_PROJECT_4 } } }
			root = { enable_special_project = { name = NSC_FLAGSHIP_BUILDING_FEDERATION_PROJECT_4 location = root.capital_scope } }
		}
		if = {
			limit = { NOT = { any_member = { has_special_project = NSC_FLAGSHIP_BUILDING_FEDERATION_PROJECT_5 } } }
			root = { enable_special_project = { name = NSC_FLAGSHIP_BUILDING_FEDERATION_PROJECT_5 location = root.capital_scope } }
		}
		if = {
			limit = { NOT = { any_member = { has_special_project = NSC_FLAGSHIP_BUILDING_FEDERATION_PROJECT_6 } } }
			root = { enable_special_project = { name = NSC_FLAGSHIP_BUILDING_FEDERATION_PROJECT_6 location = root.capital_scope } }
		}
	}
	#reset variable for later use
	set_variable = {
		which = nsc_federation_flagship_project_target_count
		value = 0
	}
	add_modifier = { modifier = nsc_federation_flagship_project days = -1 }
}


nsc_federation_flagship_project_transferred_from_destroyed_country_effect = {
	if = {
		limit = { has_special_project = NSC_FLAGSHIP_BUILDING_FEDERATION_PROJECT_1 }
		federation = {
			random_member = {
				limit = { is_federation_leader = yes }
				enable_special_project = { name = NSC_FLAGSHIP_BUILDING_FEDERATION_PROJECT_1 location = root.capital_scope }
			}
		}
	}
	if = {
		limit = { has_special_project = NSC_FLAGSHIP_BUILDING_FEDERATION_PROJECT_2 }
		federation = {
			random_member = {
				limit = { is_federation_leader = yes }
				enable_special_project = { name = NSC_FLAGSHIP_BUILDING_FEDERATION_PROJECT_2 location = root.capital_scope }
			}
		}
	}
	if = {
		limit = { has_special_project = NSC_FLAGSHIP_BUILDING_FEDERATION_PROJECT_3 }
		federation = {
			random_member = {
				limit = { is_federation_leader = yes }
				enable_special_project = { name = NSC_FLAGSHIP_BUILDING_FEDERATION_PROJECT_3 location = root.capital_scope }
			}
		}
	}
	if = {
		limit = { has_special_project = NSC_FLAGSHIP_BUILDING_FEDERATION_PROJECT_4 }
		federation = {
			random_member = {
				limit = { is_federation_leader = yes }
				enable_special_project = { name = NSC_FLAGSHIP_BUILDING_FEDERATION_PROJECT_4 location = root.capital_scope }
			}
		}
	}
	if = {
		limit = { has_special_project = NSC_FLAGSHIP_BUILDING_FEDERATION_PROJECT_5 }
		federation = {
			random_member = {
				limit = { is_federation_leader = yes }
				enable_special_project = { name = NSC_FLAGSHIP_BUILDING_FEDERATION_PROJECT_5 location = root.capital_scope }
			}
		}
	}
	if = {
		limit = { has_special_project = NSC_FLAGSHIP_BUILDING_FEDERATION_PROJECT_6 }
		federation = {
			random_member = {
				limit = { is_federation_leader = yes }
				enable_special_project = { name = NSC_FLAGSHIP_BUILDING_FEDERATION_PROJECT_6 location = root.capital_scope }
			}
		}
	}
}



edict_nsc_flagship_ruler_captain_effect = {
	if = {
		limit = { NOT = { has_country_flag = nsc_flagship_ruler_leader_country } }
		custom_tooltip = edict_nsc_flagship_ruler_captain_tooltip
		if = {
			limit = { NOT = { any_owned_leader = { has_leader_flag = nsc_flagship_ruler_leader } } }
			clone_leader = {
				target = ruler
				class = admiral
				traits = {
					trait = leader_trait_flagship
				}
				effect = {
					prev.ruler = { set_leader_flag = nsc_flagship_ruler }
					set_leader_flag = nsc_flagship_ruler_leader
					if = {
						limit = { has_skill < 3 }
						set_skill = 3
					}
				}
			}
		}
		random_owned_leader = {
			limit = { has_leader_flag = nsc_flagship_ruler_leader }
			save_event_target_as = nsc_flagship_ruler_leader_target
		}
		random_owned_fleet = {
			limit = { any_owned_ship = { is_ship_size = Flagship } }
			assign_leader = event_target:nsc_flagship_ruler_leader_target
			settings = { can_change_leader = no }
		}
		set_country_flag = nsc_flagship_ruler_leader_country
		else = {
			remove_country_flag = nsc_flagship_ruler_leader_country
			custom_tooltip = edict_nsc_flagship_ruler_captain_tooltip_alt
			random_owned_leader = {
				limit = { has_leader_flag = nsc_flagship_ruler_leader }
				unassign_leader = this
			}
		}
	}
}