#
# Space Exploitation
#
# Modif by Calvitix 
#
# energy -> power_plant_
# mine -> minerals_mine
# alloy -> alloys_mine
# foundry -> alloys_foundry
# research -> research_lab
# motes -> motes_mine
# gases -> gases_well
# crystals -> crystal_mine
#
#
#
#
is_base_planet = {
	OR = {
		is_planet_class = pc_barren
		is_planet_class = pc_barren_cold
	}
}

is_difficult_planet = {
	OR = {
		is_planet_class = pc_molten
		is_planet_class = pc_toxic
		is_planet_class = pc_frozen
		is_planet_class = pc_broken
		is_planet_class = pc_shattered
		NOR = {
			is_base_planet = yes
			is_planet_class = pc_molten
			is_planet_class = pc_toxic
			is_planet_class = pc_frozen
			is_planet_class = pc_broken
			is_planet_class = pc_shattered
			is_vacuum_planet = yes
		}
	}
}

is_vacuum_planet = {
	OR = {
		is_planet_class = pc_gas_giant
		is_planet_class = pc_asteroid
		is_planet_class = pc_ice_asteroid
		is_planet_class = pc_rare_crystal_asteroid
	}
}

#Planet Scope
system_has_colonizeable_planet = {
	NOT = { has_modifier = colonized_planet }
	has_exploit_technology = yes
	can_build_exploit_colony = yes
}

system_has_colonizeable_power_plant_planet = {
	NOT = { has_modifier = colonized_planet }
	has_exploit_technology = yes
	can_build_exploit_colony = yes
	is_planet_class = pc_gas_giant
}

system_has_colonizeable_minerals_mine_planet = {
	NOT = { has_modifier = colonized_planet }
	has_exploit_technology = yes
	can_build_exploit_colony = yes
	NOT = { is_planet_class = pc_gas_giant }
}

system_has_colonizeable_alloys_mine_planet = {
	NOT = { has_modifier = colonized_planet }
	has_exploit_technology = yes
	can_build_exploit_colony = yes
	OR = {
		is_planet_class = pc_asteroid
		is_planet_class = pc_broken
		is_planet_class = pc_shattered
	}
}

system_has_colonizeable_alloys_foundry_planet = {
	NOT = { has_modifier = colonized_planet }
	has_exploit_technology = yes
	can_build_exploit_colony = yes
}

system_has_colonizeable_lava_refinery_planet = {
	NOT = { has_modifier = colonized_planet }
	has_exploit_technology = yes
	can_build_exploit_colony = yes
	is_planet_class = pc_molten
}

system_has_colonizeable_research_lab_planet = {
	NOT = { has_modifier = colonized_planet }
	has_exploit_technology = yes
	can_build_exploit_colony = yes
}

system_has_colonizeable_motes_mine_planet = {
	NOT = { has_modifier = colonized_planet }
	has_exploit_technology = yes
	can_build_exploit_colony = yes
	is_planet_class = pc_molten
}

system_has_colonizeable_gases_well_planet = {
	NOT = { has_modifier = colonized_planet }
	has_exploit_technology = yes
	can_build_exploit_colony = yes
	OR = {
		is_planet_class = pc_gas_giant
		is_planet_class = pc_toxic
	}
}

system_has_colonizeable_crystals_mine_planet = {
	NOT = { has_modifier = colonized_planet }
	has_exploit_technology = yes
	can_build_exploit_colony = yes
	is_planet_class = pc_rare_crystal_asteroid
}

#System Scope
system_has_exploit = {
	any_system_planet = {
		has_planet_flag = flg_exploit_center
	}
}

#System Scope
system_has_viable_exploit_host = {
	NOT = { any_system_planet = {
		has_planet_flag = flg_exploit_center
	} }
	any_system_planet = {
		NOT = { has_planet_flag = flg_exploit_center }
		is_major_colony = yes
	}
}

has_perm_flag = {
	OR = {
		has_planet_flag = flg_exploit_minerals_mine_loop
		has_planet_flag = flg_exploit_power_plant_loop
		has_planet_flag = flg_exploit_alloys_mine_loop
		has_planet_flag = flg_exploit_alloys_foundry_loop
		has_planet_flag = flg_exploit_lava_refinery_loop
		has_planet_flag = flg_exploit_research_lab_loop
		has_planet_flag = flg_exploit_motes_mine_loop
		has_planet_flag = flg_exploit_gases_well_loop
		has_planet_flag = flg_exploit_crystals_mine_loop
	}
}

#Country Scope
has_exploit_queue = {
	log = "has_exploit_queue check begin"
	OR = {
		check_variable = { which = var_exploit_power_plant_queue value > 0 }
		check_variable = { which = var_exploit_minerals_mine_queue value > 0 }
		check_variable = { which = var_exploit_alloys_mine_queue value > 0 }
		check_variable = { which = var_exploit_alloys_foundry_queue value > 0 }
		check_variable = { which = var_exploit_research_lab_queue value > 0 }
		check_variable = { which = var_exploit_lava_refinery_queue value > 0 }
		check_variable = { which = var_exploit_motes_mine_queue value > 0 }
		check_variable = { which = var_exploit_gases_well_queue value > 0 }
		check_variable = { which = var_exploit_crystals_mine_queue value > 0 }
	}
	log = "has_exploit_queue check end"	
}

#Planet Scope
has_exploit_technology = {
	OR = {
		is_planet_class = pc_barren
		is_planet_class = pc_barren_cold
		is_planet_class = pc_molten
		is_planet_class = pc_toxic
		is_planet_class = pc_frozen
		is_planet_class = pc_asteroid
		is_planet_class = pc_ice_asteroid
		is_planet_class = pc_rare_crystal_asteroid
		AND = {
			is_planet_class = pc_gas_giant
			space_owner = { has_technology = tech_habitat_1 }
		}
	}
}

#Planet scope
can_build_exploit_colony = {
	log = "Checking can_build_exploit_colony" 
	OR = {
		AND = {
			is_base_planet = yes
			space_owner = {
				resource_stockpile_compare = {
					resource = energy
					value >= @BaseEnergyCost
				}
				resource_stockpile_compare = {
					resource = alloys
					value >= @BaseAlloyCost
				}
				resource_stockpile_compare = {
					resource = minerals
					value >= @BaseMineralCost
				}
			}
			log = "Is_base + Enough ressources" 
		}
		AND = {
			is_difficult_planet = yes
			space_owner = {
				resource_stockpile_compare = {
					resource = energy
					value >= @DifficultEnergyCost
				}
				resource_stockpile_compare = {
					resource = alloys
					value >= @DifficultAlloyCost
				}
				resource_stockpile_compare = {
					resource = minerals
					value >= @DifficultMineralCost
				}
			}
			log = "Is_difficult planet + Enough ressources" 			
		}
		AND = {
			is_vacuum_planet = yes
			space_owner = {
				resource_stockpile_compare = {
					resource = energy
					value >= @VacuumEnergyCost
				}
				resource_stockpile_compare = {
					resource = alloys
					value >= @VacuumAlloyCost
				}
				resource_stockpile_compare = {
					resource = minerals
					value >= @VacuumMineralCost
				}
			}
			log = "Is_vacuum planet + Enough ressources" 						
		}
		
	}
}
can_build_exploit_minerals_mine = {
	check_variable = { which = var_exploitation_size value > 0 }
	count_deposits = { type = d_energy_1 count > 0 }
	OR = {
		AND = {
			is_base_planet = yes
			space_owner = {
				resource_stockpile_compare = {
					resource = energy
					value >= @BaseEnergyCost
				}
				resource_stockpile_compare = {
					resource = alloys
					value >= @BaseAlloyCost
				}
				resource_stockpile_compare = {
					resource = minerals
					value >= @BaseMineralCost
				}
			}
		}
		AND = {
			is_difficult_planet = yes
			space_owner = {
				resource_stockpile_compare = {
					resource = energy
					value >= @DifficultEnergyCost
				}
				resource_stockpile_compare = {
					resource = alloys
					value >= @DifficultAlloyCost
				}
				resource_stockpile_compare = {
					resource = minerals
					value >= @DifficultMineralCost
				}
			}
		}
		AND = {
			is_vacuum_planet = yes
			space_owner = {
				resource_stockpile_compare = {
					resource = energy
					value >= @VacuumEnergyCost
				}
				resource_stockpile_compare = {
					resource = alloys
					value >= @VacuumAlloyCost
				}
				resource_stockpile_compare = {
					resource = minerals
					value >= @VacuumMineralCost
				}
			}
		}
		
	}
}
can_build_exploit_power_plant = {
	check_variable = { which = var_exploitation_size value > 0 }
	OR = {
		AND = {
			is_base_planet = yes
			space_owner = {
				resource_stockpile_compare = {
					resource = energy
					value >= @BaseEnergyCost
				}
				resource_stockpile_compare = {
					resource = alloys
					value >= @BaseAlloyCost
				}
				resource_stockpile_compare = {
					resource = minerals
					value >= @BaseMineralCost
				}
			}
		}
		AND = {
			is_difficult_planet = yes
			space_owner = {
				resource_stockpile_compare = {
					resource = energy
					value >= @DifficultEnergyCost
				}
				resource_stockpile_compare = {
					resource = alloys
					value >= @DifficultAlloyCost
				}
				resource_stockpile_compare = {
					resource = minerals
					value >= @DifficultMineralCost
				}
			}
		}
		AND = {
			is_vacuum_planet = yes
			space_owner = {
				resource_stockpile_compare = {
					resource = energy
					value >= @VacuumEnergyCost
				}
				resource_stockpile_compare = {
					resource = alloys
					value >= @VacuumAlloyCost
				}
				resource_stockpile_compare = {
					resource = minerals
					value >= @VacuumMineralCost
				}
			}
		}
	}
}
can_build_exploit_alloys_mine = {
	check_variable = { which = var_exploitation_size value > 0 }
	count_deposits = { type = d_energy_1 count > 0 }
	OR = {
		AND = {
			is_base_planet = yes
			space_owner = {
				resource_stockpile_compare = {
					resource = energy
					value >= @BaseEnergyCost
				}
				resource_stockpile_compare = {
					resource = alloys
					value >= @BaseAlloyCost
				}
				resource_stockpile_compare = {
					resource = minerals
					value >= @BaseMineralCost
				}
			}
		}
		AND = {
			is_difficult_planet = yes
			space_owner = {
				resource_stockpile_compare = {
					resource = energy
					value >= @DifficultEnergyCost
				}
				resource_stockpile_compare = {
					resource = alloys
					value >= @DifficultAlloyCost
				}
				resource_stockpile_compare = {
					resource = minerals
					value >= @DifficultMineralCost
				}
			}
		}
		AND = {
			is_vacuum_planet = yes
			space_owner = {
				resource_stockpile_compare = {
					resource = energy
					value >= @VacuumEnergyCost
				}
				resource_stockpile_compare = {
					resource = alloys
					value >= @VacuumAlloyCost
				}
				resource_stockpile_compare = {
					resource = minerals
					value >= @VacuumMineralCost
				}
			}
		}
	}
}
can_build_exploit_alloys_foundry = {
	check_variable = { which = var_exploitation_size value > 0 }
	count_deposits = { type = d_energy_1 count > 0 }
	count_deposits = { type = d_minerals_1 count > 1 }
	space_owner = {
		resource_stockpile_compare = {
			resource = volatile_motes
			value >= @BaseSRCost
		}
	}
	OR = {
		AND = {
			is_base_planet = yes
			space_owner = {
				resource_stockpile_compare = {
					resource = energy
					value >= @BaseEnergyCost
				}
				resource_stockpile_compare = {
					resource = alloys
					value >= @BaseAlloyCost
				}
				resource_stockpile_compare = {
					resource = minerals
					value >= @BaseMineralCost
				}
			}
		}
		AND = {
			is_difficult_planet = yes
			space_owner = {
				resource_stockpile_compare = {
					resource = energy
					value >= @DifficultEnergyCost
				}
				resource_stockpile_compare = {
					resource = alloys
					value >= @DifficultAlloyCost
				}
				resource_stockpile_compare = {
					resource = minerals
					value >= @DifficultMineralCost
				}
			}
		}
		AND = {
			is_vacuum_planet = yes
			space_owner = {
				resource_stockpile_compare = {
					resource = energy
					value >= @VacuumEnergyCost
				}
				resource_stockpile_compare = {
					resource = alloys
					value >= @VacuumAlloyCost
				}
				resource_stockpile_compare = {
					resource = minerals
					value >= @VacuumMineralCost
				}
			}
		}
	}
}
can_build_exploit_lava_refinery = {
	check_variable = { which = var_exploitation_size value > 0 }
	OR = {
		AND = {
			is_base_planet = yes
			space_owner = {
				resource_stockpile_compare = {
					resource = energy
					value >= @AdvancedBaseEnergyCost
				}
				resource_stockpile_compare = {
					resource = alloys
					value >= @AdvancedBaseAlloyCost
				}
				resource_stockpile_compare = {
					resource = minerals
					value >= @AdvancedBaseMineralCost
				}
			}
		}
		AND = {
			is_difficult_planet = yes
			space_owner = {
				resource_stockpile_compare = {
					resource = energy
					value >= @AdvancedDifficultEnergyCost
				}
				resource_stockpile_compare = {
					resource = alloys
					value >= @AdvancedDifficultAlloyCost
				}
				resource_stockpile_compare = {
					resource = minerals
					value >= @AdvancedDifficultMineralCost
				}
			}
		}
		AND = {
			is_vacuum_planet = yes
			space_owner = {
				resource_stockpile_compare = {
					resource = energy
					value >= @AdvancedVacuumEnergyCost
				}
				resource_stockpile_compare = {
					resource = alloys
					value >= @AdvancedVacuumAlloyCost
				}
				resource_stockpile_compare = {
					resource = minerals
					value >= @AdvancedVacuumMineralCost
				}
			}
		}
	}
}
can_build_exploit_research_lab = {
	check_variable = { which = var_exploitation_size value > 0 }
	count_deposits = { type = d_energy_1 count > 1 }
	space_owner = {
		resource_stockpile_compare = {
			resource = exotic_gases
			value >= @BaseSRCost
		}
	}
	OR = {
		AND = {
			is_base_planet = yes
			space_owner = {
				resource_stockpile_compare = {
					resource = energy
					value >= @AdvancedBaseEnergyCost
				}
				resource_stockpile_compare = {
					resource = alloys
					value >= @AdvancedBaseAlloyCost
				}
				resource_stockpile_compare = {
					resource = minerals
					value >= @AdvancedBaseMineralCost
				}
			}
		}
		AND = {
			is_difficult_planet = yes
			space_owner = {
				resource_stockpile_compare = {
					resource = energy
					value >= @AdvancedDifficultEnergyCost
				}
				resource_stockpile_compare = {
					resource = alloys
					value >= @AdvancedDifficultAlloyCost
				}
				resource_stockpile_compare = {
					resource = minerals
					value >= @AdvancedDifficultMineralCost
				}
			}
		}
		AND = {
			is_vacuum_planet = yes
			space_owner = {
				resource_stockpile_compare = {
					resource = energy
					value >= @AdvancedVacuumEnergyCost
				}
				resource_stockpile_compare = {
					resource = alloys
					value >= @AdvancedVacuumAlloyCost
				}
				resource_stockpile_compare = {
					resource = minerals
					value >= @AdvancedVacuumMineralCost
				}
			}
		}
	}
}
can_build_exploit_motes_mine = {
	check_variable = { which = var_exploitation_size value > 0 }
	count_deposits = { type = d_energy_1 count > 0 }
	OR = {
		AND = {
			is_base_planet = yes
			space_owner = {
				resource_stockpile_compare = {
					resource = energy
					value >= @BaseEnergyCost
				}
				resource_stockpile_compare = {
					resource = alloys
					value >= @BaseAlloyCost
				}
				resource_stockpile_compare = {
					resource = minerals
					value >= @BaseMineralCost
				}
			}
		}
		AND = {
			is_difficult_planet = yes
			space_owner = {
				resource_stockpile_compare = {
					resource = energy
					value >= @DifficultEnergyCost
				}
				resource_stockpile_compare = {
					resource = alloys
					value >= @DifficultAlloyCost
				}
				resource_stockpile_compare = {
					resource = minerals
					value >= @DifficultMineralCost
				}
			}
		}
		AND = {
			is_vacuum_planet = yes
			space_owner = {
				resource_stockpile_compare = {
					resource = energy
					value >= @VacuumEnergyCost
				}
				resource_stockpile_compare = {
					resource = alloys
					value >= @VacuumAlloyCost
				}
				resource_stockpile_compare = {
					resource = minerals
					value >= @VacuumMineralCost
				}
			}
		}
	}
}
can_build_exploit_gases_well = {
	check_variable = { which = var_exploitation_size value > 0 }
	count_deposits = { type = d_energy_1 count > 0 }
	OR = {
		AND = {
			is_base_planet = yes
			space_owner = {
				resource_stockpile_compare = {
					resource = energy
					value >= @BaseEnergyCost
				}
				resource_stockpile_compare = {
					resource = alloys
					value >= @BaseAlloyCost
				}
				resource_stockpile_compare = {
					resource = minerals
					value >= @BaseMineralCost
				}
			}
		}
		AND = {
			is_difficult_planet = yes
			space_owner = {
				resource_stockpile_compare = {
					resource = energy
					value >= @DifficultEnergyCost
				}
				resource_stockpile_compare = {
					resource = alloys
					value >= @DifficultAlloyCost
				}
				resource_stockpile_compare = {
					resource = minerals
					value >= @DifficultMineralCost
				}
			}
		}
		AND = {
			is_vacuum_planet = yes
			space_owner = {
				resource_stockpile_compare = {
					resource = energy
					value >= @VacuumEnergyCost
				}
				resource_stockpile_compare = {
					resource = alloys
					value >= @VacuumAlloyCost
				}
				resource_stockpile_compare = {
					resource = minerals
					value >= @VacuumMineralCost
				}
			}
		}
	}
}
can_build_exploit_crystals_mine = {
	check_variable = { which = var_exploitation_size value > 0 }
	count_deposits = { type = d_energy_1 count > 0 }
	OR = {
		AND = {
			is_base_planet = yes
			space_owner = {
				resource_stockpile_compare = {
					resource = energy
					value >= @BaseEnergyCost
				}
				resource_stockpile_compare = {
					resource = alloys
					value >= @BaseAlloyCost
				}
				resource_stockpile_compare = {
					resource = minerals
					value >= @BaseMineralCost
				}
			}
		}
		AND = {
			is_difficult_planet = yes
			space_owner = {
				resource_stockpile_compare = {
					resource = energy
					value >= @DifficultEnergyCost
				}
				resource_stockpile_compare = {
					resource = alloys
					value >= @DifficultAlloyCost
				}
				resource_stockpile_compare = {
					resource = minerals
					value >= @DifficultMineralCost
				}
			}
		}
		AND = {
			is_vacuum_planet = yes
			space_owner = {
				resource_stockpile_compare = {
					resource = energy
					value >= @VacuumEnergyCost
				}
				resource_stockpile_compare = {
					resource = alloys
					value >= @VacuumAlloyCost
				}
				resource_stockpile_compare = {
					resource = minerals
					value >= @VacuumMineralCost
				}
			}
		}
	}
}