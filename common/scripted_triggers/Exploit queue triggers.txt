#
# Space Exploitation
#
# Modif by Calvitix 
#
# energy -> power_plant_
# mine -> minerals_mine
# alloy -> alloys_mine
# foundry -> alloys_foundry
# research -> research_lab
# motes -> motes_mine
# gases -> gases_well
# crystals -> crystal_mine
#
# calvitix modifs : prefix var_ for all variables, Flg_  for flags
#
# update 29/09/2021
#
is_base_planet = {
	OR = {
		is_planet_class = pc_barren
		is_planet_class = pc_barren_cold
	}
}

is_difficult_planet = {
	OR = {
		is_planet_class = pc_molten
		is_planet_class = pc_toxic
		is_planet_class = pc_frozen
		is_planet_class = pc_broken
		is_planet_class = pc_shattered
		NOR = {
			is_base_planet = yes
			is_planet_class = pc_molten
			is_planet_class = pc_toxic
			is_planet_class = pc_frozen
			is_planet_class = pc_broken
			is_planet_class = pc_shattered
			is_vacuum_planet = yes
		}
	}
}

is_vacuum_planet = {
	OR = {
		is_planet_class = pc_gas_giant
		is_planet_class = pc_asteroid
		is_planet_class = pc_ice_asteroid
		is_planet_class = pc_rare_crystal_asteroid
	}
}

#Not Planet, System Scope
system_has_colonizable_planet = {
	#log = "Check system_has_colonizable_planet for \\[ROOT.GetName]"
	any_system_planet = {
		NOT = { has_modifier = colonized_planet }
		has_exploit_technology = yes
		can_build_exploit_colony = yes
		#log = "Check system_has_colonizable_planet for \\[ROOT.GetName] : OK"
	}
}

system_has_colonizeable_power_plant_planet = {
	NOT = { has_modifier = colonized_planet }
	has_exploit_technology = yes
	can_build_exploit_colony = yes
	space_owner = { NOT = { has_country_flag = flg_exploit_power_off } }
	#is_planet_class = pc_gas_giant
}

system_has_colonizeable_minerals_mine_planet = {
	NOT = { has_modifier = colonized_planet }
	has_exploit_technology = yes
	can_build_exploit_colony = yes
	NOT = { is_planet_class = pc_gas_giant }
	space_owner = { NOT = { has_country_flag = flg_exploit_mine_off } }
}

system_has_colonizeable_alloys_mine_planet = {
	NOT = { has_modifier = colonized_planet }
	has_exploit_technology = yes
	can_build_exploit_colony = yes
	OR = {
		is_planet_class = pc_asteroid
		is_planet_class = pc_broken
		is_planet_class = pc_shattered
	}
	space_owner = { NOT = { has_country_flag = flg_exploit_alloy_mine_off } }
}

system_has_colonizeable_alloys_foundry_planet = {
	NOT = { has_modifier = colonized_planet }
	has_exploit_technology = yes
	can_build_exploit_colony = yes
	space_owner = { NOT = { has_country_flag = flg_exploit_alloy_foundry_off } }
}

system_has_colonizeable_research_lab_planet = {
	NOT = { has_modifier = colonized_planet }
	has_exploit_technology = yes
	can_build_exploit_colony = yes
	space_owner = { NOT = { has_country_flag = flg_exploit_research_off } }
}

system_has_colonizeable_lava_refinery_planet = {
	NOT = { has_modifier = colonized_planet }
	has_exploit_technology = yes
	can_build_exploit_colony = yes
	is_planet_class = pc_molten
	space_owner = { NOT = { has_country_flag = flg_exploit_lava_refinery_off } }
}



system_has_colonizeable_motes_mine_planet = {
	NOT = { has_modifier = colonized_planet }
	has_exploit_technology = yes
	can_build_exploit_colony = yes
	is_planet_class = pc_molten
	space_owner = { NOT = { has_country_flag = flg_exploit_motes_off } }
}

system_has_colonizeable_gases_well_planet = {
	NOT = { has_modifier = colonized_planet }
	has_exploit_technology = yes
	can_build_exploit_colony = yes
	OR = {
		is_planet_class = pc_gas_giant
		is_planet_class = pc_toxic
	}
	space_owner = { NOT = { has_country_flag = flg_exploit_gases_off } }
}

system_has_colonizeable_crystals_mine_planet = {
	NOT = { has_modifier = colonized_planet }
	has_exploit_technology = yes
	can_build_exploit_colony = yes
	OR = {
	is_planet_class = pc_rare_crystal_asteroid
		is_planet_class = pc_ice_asteroid
	}
	space_owner = { NOT = { has_country_flag = flg_exploit_crystals_off } }
}

#System Scope
system_has_exploit = {
	any_system_planet = {
		has_planet_flag = flg_exploit_center
	}
}

#System Scope
system_has_viable_exploit_host = {
	NOT = { any_system_planet = {
		has_planet_flag = flg_exploit_center
	} }
	any_system_planet = {
		NOT = { has_planet_flag = flg_exploit_center }
		is_major_colony = yes
	}
}

has_perm_flag = {
	OR = {
		has_planet_flag = flg_exploit_minerals_mine_loop
		has_planet_flag = flg_exploit_power_plant_loop
		has_planet_flag = flg_exploit_alloys_mine_loop
		has_planet_flag = flg_exploit_alloys_foundry_loop
		has_planet_flag = flg_exploit_lava_refinery_loop
		has_planet_flag = flg_exploit_research_lab_loop
		has_planet_flag = flg_exploit_motes_mine_loop
		has_planet_flag = flg_exploit_gases_well_loop
		has_planet_flag = flg_exploit_crystals_mine_loop
	}
}

#Country Scope
has_exploit_queue = {
	#log = "has_exploit_queue check begin"
	OR = {
		check_variable = { which = var_exploit_power_plant_queue value > 0 }
		check_variable = { which = var_exploit_minerals_mine_queue value > 0 }
		check_variable = { which = var_exploit_alloys_mine_queue value > 0 }
		check_variable = { which = var_exploit_alloys_foundry_queue value > 0 }
		check_variable = { which = var_exploit_research_lab_queue value > 0 }
		check_variable = { which = var_exploit_lava_refinery_queue value > 0 }
		check_variable = { which = var_exploit_motes_mine_queue value > 0 }
		check_variable = { which = var_exploit_gases_well_queue value > 0 }
		check_variable = { which = var_exploit_crystals_mine_queue value > 0 }
	}
	#log = "has_exploit_queue check end"	
}

#Planet Scope
has_exploit_technology = {
	OR = {
		AND = {
		is_planet_class = pc_barren
			space_owner = { NOT = { has_country_flag = flg_exploit_barren_off } }
		}
		AND = {
		is_planet_class = pc_barren_cold
			space_owner = { NOT = { has_country_flag = flg_exploit_barren_off } }
		}
		AND = {
		is_planet_class = pc_molten
			space_owner = { NOT = { has_country_flag = flg_exploit_molten_off } }
		}
		AND = {
		is_planet_class = pc_toxic
			space_owner = { NOT = { has_country_flag = flg_exploit_toxic_off } }
		}
		AND = {
		is_planet_class = pc_frozen
			space_owner = { NOT = { has_country_flag = flg_exploit_frozen_off } }
		}
		AND = {
		is_planet_class = pc_asteroid
			space_owner = { NOT = { has_country_flag = flg_exploit_asteroid_off } }
		}
		AND = {
		is_planet_class = pc_ice_asteroid
			space_owner = { NOT = { has_country_flag = flg_exploit_ice_asteroid_off } }
		}
		AND = {
		is_planet_class = pc_rare_crystal_asteroid
			space_owner = { NOT = { has_country_flag = flg_exploit_asteroid_off } }
		}
		AND = {
			is_planet_class = pc_gas_giant
			space_owner = { NOT = { has_country_flag = flg_exploit_gas_giant_off } }
			space_owner = { has_technology = tech_habitat_1 }
		}
		AND = {
			OR = {
				is_planet_class = pc_shattered
				is_planet_class = pc_broken
			}
			space_owner = { NOT = { has_country_flag = flg_exploit_shattered_off } }
		}
	}
}

#Planet scope
can_build_exploit_colony = {
	hidden_trigger = {
	exists = space_owner
	}
	space_owner = { has_technology = "tech_starbase_3"}
	hidden_trigger = {
	OR = {
		AND = {
			is_base_planet = yes
			base_planet_cost_check = yes
		}
		AND = {
			is_difficult_planet = yes
			difficult_planet_cost_check = yes
		}
		AND = {
			is_vacuum_planet = yes
			vacuum_planet_cost_check = yes
		}
	}
	}
}

can_build_exploit_minerals_mine = {
	check_variable = { which = var_exploitation_size value > 0 }
	count_deposits = { type = d_energy_1 count > 0 }
	OR = {
		AND = {
			is_base_planet = yes
			base_planet_cost_check = yes
		}
		AND = {
			is_difficult_planet = yes
			difficult_planet_cost_check = yes
		}
		AND = {
			is_vacuum_planet = yes
			vacuum_planet_cost_check = yes
		}
		
	}
}
can_build_exploit_power_plant = {
	check_variable = { which = var_exploitation_size value > 0 }
	OR = {
		AND = {
			is_base_planet = yes
			base_planet_cost_check = yes
		}
		AND = {
			is_difficult_planet = yes
			difficult_planet_cost_check = yes
		}
		AND = {
			is_vacuum_planet = yes
			vacuum_planet_cost_check = yes
				}
	}
}
can_build_exploit_alloys_mine = {
	check_variable = { which = var_exploitation_size value > 0 }
	count_deposits = { type = d_energy_1 count > 0 }
	OR = {
		AND = {
			is_base_planet = yes
			base_planet_cost_check = yes
		}
		AND = {
			is_difficult_planet = yes
			difficult_planet_cost_check = yes
		}
		AND = {
			is_vacuum_planet = yes
			vacuum_planet_cost_check = yes
				}
	}
}
can_build_exploit_alloys_foundry = {
	check_variable = { which = var_exploitation_size value > 0 }
	count_deposits = { type = d_energy_1 count > 0 }
	count_deposits = { type = d_minerals_1 count > 1 }
	space_owner = {
		base_cost_motes_check = yes
	}
	OR = {
		AND = {
			is_base_planet = yes
			base_planet_cost_check = yes
		}
		AND = {
			is_difficult_planet = yes
			difficult_planet_cost_check = yes
		}
		AND = {
			is_vacuum_planet = yes
			vacuum_planet_cost_check = yes
				}
	}
}
can_build_exploit_lava_refinery = {
	check_variable = { which = var_exploitation_size value > 0 }
	OR = {
		AND = {
			is_base_planet = yes
			advanced_base_planet_cost_check = yes
		}
		AND = {
			is_difficult_planet = yes
			advanced_difficult_planet_cost_check = yes
		}
		AND = {
			is_vacuum_planet = yes
			advanced_vacuum_planet_cost_check = yes
		}
	}
}
can_build_exploit_research_lab = {
	check_variable = { which = var_exploitation_size value > 0 }
	count_deposits = { type = d_energy_1 count > 1 }
	space_owner = {
		base_cost_gases_check = yes
	}
	OR = {
		AND = {
			is_base_planet = yes
			advanced_base_planet_cost_check = yes
		}
		AND = {
			is_difficult_planet = yes
			advanced_difficult_planet_cost_check = yes
		}
		AND = {
			is_vacuum_planet = yes
			advanced_vacuum_planet_cost_check = yes
		}
	}
}
can_build_exploit_motes_mine = {
	check_variable = { which = var_exploitation_size value > 0 }
	count_deposits = { type = d_energy_1 count > 1 }
	OR = {
		AND = {
			is_base_planet = yes
			base_planet_cost_check = yes
		}
		AND = {
			is_difficult_planet = yes
			difficult_planet_cost_check = yes
		}
		AND = {
			is_vacuum_planet = yes
			vacuum_planet_cost_check = yes
				}
	}
}
can_build_exploit_gases_well = {
	check_variable = { which = var_exploitation_size value > 0 }
	count_deposits = { type = d_energy_1 count > 1 }
	OR = {
		AND = {
			is_base_planet = yes
			base_planet_cost_check = yes
		}
		AND = {
			is_difficult_planet = yes
			difficult_planet_cost_check = yes
		}
		AND = {
			is_vacuum_planet = yes
			vacuum_planet_cost_check = yes
				}
	}
}
can_build_exploit_crystals_mine = {
	check_variable = { which = var_exploitation_size value > 0 }
	count_deposits = { type = d_energy_1 count > 1 }
	OR = {
		AND = {
			is_base_planet = yes
			base_planet_cost_check = yes
		}
		AND = {
			is_difficult_planet = yes
			difficult_planet_cost_check = yes
		}
		AND = {
			is_vacuum_planet = yes
			vacuum_planet_cost_check = yes
				}
	}
}