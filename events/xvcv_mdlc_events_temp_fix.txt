namespace = xvcv_mdlc_temp_fix
#added to counter a bug that if a district is already queued, it can be built regardless of its potential or allow triggers #stellaris v3.4.2
planet_event = {
	id = xvcv_mdlc_temp_fix.10
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		last_district_changed = xvcv_mdlc_common_district_cooling
		check_variable = { which = xvcv_mdlc_world_machines_districts_output_var value > 0.3 }
	}

	immediate = {
		remove_last_built_district = yes
		owner = { add_resource = { minerals = @xvcv_mdlc_district_cost_5 } } #refund its cost
		change_variable = { which = xvcv_mdlc_world_machines_districts_output_var value = -0.3 } #minus 0.3 output as a cooler is gone
	}
}
#until the 'on_spynetwork_formed' on_action trigger is fixed #stellaris v3.4.2
#https://forum.paradoxplaza.com/forum/threads/stellaris-the-on_spynetwork_formed-on_action-trigger-is-broken.1525048/
event = {
	id = xvcv_mdlc_temp_fix.20
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		any_country = { has_valid_civic = xvcv_mdlc_civic_malware_machine }
	}

	immediate = {
		every_country = {
			limit = { has_valid_civic = xvcv_mdlc_civic_malware_machine }
			every_spynetwork = {
				limit = {
					owner = {
						has_valid_civic = xvcv_mdlc_civic_malware_machine
						any_envoy = { exists = spynetwork spynetwork = { is_same_value = prevprevprev } } #only when the spynetwork is formed
					}
					NOT = { has_espionage_asset = xvcv_mdlc_asset_malware }
				}
				create_espionage_asset = { type = xvcv_mdlc_asset_malware }
			}
		}
	}
}