namespace = xvcv_mdlc_temp_fix
#added to counter a bug that if a district is already queued, it can be built regardless of its potential or allow triggers #stellaris v3.4.5
#https://forum.paradoxplaza.com/forum/threads/stellaris-queued-districts-ignore-their-build-limits.1471889/
planet_event = {
	id = xvcv_mdlc_temp_fix.10
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		#last_district_changed = xvcv_mdlc_common_district_cooling #disabled #the event doesn't happen with this code #It was fine as I remember, wth? #stellaris v3.4.5
		check_variable = { which = xvcv_mdlc_world_machines_districts_output_var value >= 0 }
	}

	immediate = {
		remove_district = xvcv_mdlc_common_district_cooling
		owner = { add_resource = { minerals = @xvcv_mdlc_district_cost_5 } } #refund its costs
		change_variable = { which = xvcv_mdlc_world_machines_districts_output_var value = -0.3 } #minus 0.3 output as a cooler is gone
		change_variable = { which = xvcv_mdlc_world_machines_districts_current_output_for_display_var value = -30 } #change this as well
	}
}
#until the 'on_spynetwork_formed' on_action trigger is fixed #stellaris v3.4.2
#https://forum.paradoxplaza.com/forum/threads/stellaris-the-on_spynetwork_formed-on_action-trigger-is-broken.1525048/
event = {
	id = xvcv_mdlc_temp_fix.20
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		any_country = { has_valid_civic = xvcv_mdlc_civic_malware_machine }
	}

	immediate = {
		every_country = {
			limit = { has_valid_civic = xvcv_mdlc_civic_malware_machine }
			every_spynetwork = {
				limit = {
					owner = {
						has_valid_civic = xvcv_mdlc_civic_malware_machine
						any_envoy = { exists = spynetwork spynetwork = { is_same_value = prevprevprev } } #only when the spynetwork is formed
					}
					NOT = { has_espionage_asset = xvcv_mdlc_asset_malware }
				}
				create_espionage_asset = { type = xvcv_mdlc_asset_malware }
			}
		}
	}
}