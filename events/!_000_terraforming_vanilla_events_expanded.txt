############################
#
# Terraforming Events
# By Victor Haeggman
#
############################

namespace = terra

#Saving the original planet flag
planet_event = {
	id = terra.5
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		NOT = { has_planet_flag = has_terraformflag }
	}

	immediate = {
		set_planet_flag = has_terraformflag
		switch = {
			trigger = is_planet_class
			pc_desert = { set_planet_flag = desert_terraform }
			pc_oasis = { set_planet_flag = desert_terraform }
			pc_sandsea = { set_planet_flag = desert_terraform }
			pc_mesa = { set_planet_flag = desert_terraform }
			pc_outback = { set_planet_flag = desert_terraform }
			pc_aquifer = { set_planet_flag = desert_terraform }
			pc_arid = { set_planet_flag = arid_terraform }
			pc_salt = { set_planet_flag = arid_terraform }
			pc_karst = { set_planet_flag = arid_terraform }
			pc_ash = { set_planet_flag = arid_terraform }
			pc_sulfur = { set_planet_flag = arid_terraform }
			pc_savannah = { set_planet_flag = savannah_terraform }
			pc_steppe = { set_planet_flag = savannah_terraform }
			pc_prairie = { set_planet_flag = savannah_terraform }
			pc_badlands = { set_planet_flag = savannah_terraform }
			pc_veld = { set_planet_flag = savannah_terraform }
			pc_semiarid = { set_planet_flag = savannah_terraform }
			pc_tropical = { set_planet_flag = tropical_terraform }
			pc_mangrove = { set_planet_flag = tropical_terraform }
			pc_wetswamp = { set_planet_flag = tropical_terraform }
			pc_lake = { set_planet_flag = tropical_terraform }
			pc_megaflora = { set_planet_flag = tropical_terraform }
			pc_megafloratol = { set_planet_flag = tropical_terraform }
			pc_hajungle = { set_planet_flag = tropical_terraform }
			pc_biolumen = { set_planet_flag = tropical_terraform }
			pc_forest = { set_planet_flag = tropical_terraform }
			pc_primal = { set_planet_flag = tropical_terraform }
			pc_fog = { set_planet_flag = tropical_terraform }
			pc_coastal = { set_planet_flag = tropical_terraform }
			pc_cenote = { set_planet_flag = tropical_terraform }
			pc_ocean = { set_planet_flag = ocean_terraform }
			pc_reef = { set_planet_flag = ocean_terraform }
			pc_coral = { set_planet_flag = ocean_terraform }
			pc_desertislands = { set_planet_flag = ocean_terraform }
			pc_aquatic = { set_planet_flag = ocean_terraform }
			pc_aquatichot = { set_planet_flag = ocean_terraform }
			pc_aquaticcold = { set_planet_flag = ocean_terraform }
			pc_tidallyaquatic = { set_planet_flag = ocean_terraform }
			pc_aquatic_surface = { set_planet_flag = ocean_terraform }
			pc_aquatic_uw = { set_planet_flag = ocean_terraform }
			pc_aquaticbio_uw = { set_planet_flag = ocean_terraform }
			pc_aquaticshroud_uw = { set_planet_flag = ocean_terraform }
			pc_aquaticcold_uw = { set_planet_flag = ocean_terraform }
			pc_aquatickarst_uw = { set_planet_flag = ocean_terraform }
			pc_continental = { set_planet_flag = continental_terraform }
			pc_superhabitable = { set_planet_flag = continental_terraform }
			pc_retinal = { set_planet_flag = continental_terraform }
			pc_med = { set_planet_flag = continental_terraform }
			pc_tidallylocked = { set_planet_flag = continental_terraform }
			pc_snowball = { set_planet_flag = continental_terraform }
			pc_supercon = { set_planet_flag = continental_terraform }
			pc_tepid = { set_planet_flag = continental_terraform }
			pc_tundra = { set_planet_flag = tundra_terraform }
			pc_hadesert = { set_planet_flag = tundra_terraform }
			pc_swamp = { set_planet_flag = tundra_terraform }
			pc_mud = { set_planet_flag = tundra_terraform }
			pc_mushroom = { set_planet_flag = tundra_terraform }
			pc_acid = { set_planet_flag = tundra_terraform }
			pc_basalt = { set_planet_flag = tundra_terraform }
			pc_lichen = { set_planet_flag = tundra_terraform }
			pc_aeolian = { set_planet_flag = tundra_terraform }
			pc_arctic = { set_planet_flag = arctic_terraform }
			pc_frozen_desert = { set_planet_flag = arctic_terraform }
			pc_rogue = { set_planet_flag = arctic_terraform }
			pc_eyeball = { set_planet_flag = arctic_terraform }
			pc_glacio = { set_planet_flag = arctic_terraform }
			pc_geothermal = { set_planet_flag = arctic_terraform }
			pc_glacial = { set_planet_flag = arctic_terraform }
			pc_subarctic = { set_planet_flag = arctic_terraform }
			pc_antarctic = { set_planet_flag = arctic_terraform }
			pc_snow = { set_planet_flag = arctic_terraform }
			pc_methane = { set_planet_flag = arctic_terraform }
			pc_ammonia = { set_planet_flag = arctic_terraform }
			pc_alpine = { set_planet_flag = alpine_terraform }
			pc_cascadian = { set_planet_flag = alpine_terraform }
			pc_boreal = { set_planet_flag = alpine_terraform }
			pc_duneforest = { set_planet_flag = alpine_terraform }
			pc_lanthanide = { set_planet_flag = alpine_terraform }
			pc_storm = { set_planet_flag = alpine_terraform }
			pc_nuked = { set_planet_flag = nuked_terraform }
			pc_irradiated = { set_planet_flag = nuked_terraform }
			pc_barren = { set_planet_flag = barren_terraform }
			pc_barren_cold = { set_planet_flag = barren_cold_terraform }
			pc_frozen = { set_planet_flag = barren_cold_terraform }
			default = { set_planet_flag = no_terraform_event }
		}
	}
}

#Firing
planet_event = {
	id = terra.10
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		exists = space_owner
		NOR = {
			has_planet_flag = terraformed_once
			has_planet_flag = no_terraform_event
			is_planet_class = pc_relic
			is_planet_class = pc_city
		}
		can_have_habitable_deposits = yes
	}
	# All the NAND modifiers in here set up like a trigger, if anything in the NAND is not true then the event will have 0 chance of firing
	immediate = {
		set_planet_flag = terraformed_once
		random_list = {
			3 = {
				modifier = {
					factor = 0
					free_district_slots = 0
				}
				space_owner = { country_event = { id = terra.15 } } # Superfluous Terraforming Equipment
			}
			3 = {
				modifier = {
					factor = 0
					is_planet_class = pc_nuked
				}
				space_owner = { country_event = { id = terra.20 } } # Engineered Beauty
			}
			3 = {
				modifier = {
					factor = 0
					free_district_slots >= 4
				}
				space_owner = { country_event = { id = terra.25 } } # Terraforming Complications
			}
			2 = {
				modifier = {
					factor = 0
					OR = {
						is_ideal_planet_class = {
							who = space_owner
							status = no
						}
						space_owner = { has_country_flag = terraformed_homeworld_2 }
					}
				}
				space_owner = { country_event = { id = terra.35 } } # Homeworld 2
			}
			2 = {
				modifier = {
					factor = 0
					OR = {
						has_planet_flag = nuked_terraform
						has_planet_flag = barren_terraform
						has_planet_flag = barren_cold_terraform
						is_planet_class = pc_gaia
						is_planet_class = pc_nuked
						is_colony = yes
					}
				}
				space_owner = { country_event = { id = terra.40 } } # Intentionally Tidally Locked
			}
			3 = {
				modifier = {
					factor = 0
					OR = {
						has_planet_flag = barren_terraform
						has_planet_flag = barren_cold_terraform
						is_planet_class = pc_gaia
					}
				}
				space_owner = { country_event = { id = terra.45 } } # Add relevant deposit
			}
			1 = {
				modifier = { #Cannot use decimal places in the base for random_list
					factor = 0.5
					always = yes
				}
				modifier = {
					factor = 0
					OR = {
						space_owner = { is_gestalt = no }
						has_planet_flag = barren_terraform
						has_planet_flag = barren_cold_terraform
						has_planet_flag = nuked_terraform
						is_planet_class = pc_nuked
					}
				}
				space_owner = { country_event = { id = terra.50 } } # Free Hiveworld
			}
			2 = {
				modifier = {
					factor = 0
					OR = {
						space_owner = { is_gestalt = no }
						space_owner = { is_civic_machine_servitor = yes }
						has_planet_flag = barren_terraform
						has_planet_flag = barren_cold_terraform
						is_planet_class = pc_nuked
					}
				}
				space_owner = { country_event = { id = terra.55 } } # Perfect Organization
			}
			2 = {
				modifier = {
					factor = 0
					NAND = {
						OR = {
							has_planet_flag = barren_terraform
							has_planet_flag = barren_cold_terraform
						}
						has_overlord_dlc = yes
					}
				}
				space_owner = { country_event = { id = terra.60 } } # Primitives
			}
			3 = {
				modifier = {
					factor = 0
					NAND = {
						has_planet_flag = barren_terraform
						has_planet_flag = barren_cold_terraform
					}
				}
				space_owner = { country_event = { id = terra.65 } } # Refund and Gas
			}
			2 = {
				modifier = {
					factor = 0
					NAND = {
						is_planet_class = pc_gaia
						is_colony = yes
						space_owner = {
							country_uses_consumer_goods = yes
							NOT = { has_origin = origin_life_seeded }
						}
					}
				}
				space_owner = { country_event = { id = terra.70 } } # Gain Gaia Preference
			}
			2 = {
				modifier = {
					factor = 0
					NAND = {
						is_planet_class = pc_gaia
						space_owner = {
							is_gestalt = no
							NOT  = { has_country_flag = made_paradise }
						}
						is_homeworld = no
					}
				}
				space_owner = { country_event = { id = terra.75 } } # Make Paradise
			}
			2 = {
				modifier = {
					factor = 0
					NAND = {
						has_planet_flag = nuked_terraform
						host_has_dlc = "Plantoids Species Pack"
						space_owner = {
							NOT  = { has_country_flag = harvested_radiotrophic_dna }
							species = { NOT = { has_trait = trait_plantoid_radiotrophic } }
						}
						is_homeworld = no
					}
				}
				space_owner = { country_event = { id = terra.80 } } # Radiotrophic presapients
			}
			2 = {
				modifier = {
					factor = 0
					NAND = {
						has_planet_flag = nuked_terraform
						host_has_dlc = "Ancient Relics Story Pack"
						space_owner = {
							NOT  = { has_country_flag = tombworld_weapon_cache_spawned }
						}
						is_homeworld = no
					}
				}
				modifier = {
					factor = 50
					OR = {
						has_planet_flag = planet_earth
						has_planet_flag = nuked_earth
					}
				}
				space_owner = { country_event = { id = terra.90 } } # Weapon Cache
			}
			10 = {} # Do nothing
		}
	}
}

planet_event = {
	id = terra.30
	title = terra.30.name
	desc = terra.30.desc
	picture = {
		trigger = {
			is_desert = yes
		}
		picture = GFX_evt_desert
	}
	picture = {
		trigger = {
			is_tropical = yes
		}
		picture = GFX_evt_tropical
	}
	picture = {
		trigger = {
			is_arid = yes
		}
		picture = GFX_evt_arid
	}
	picture = {
		trigger = {
			OR = {
				is_continental = yes
				is_alpine = yes
				is_savannah = yes
			}
		}
		picture = GFX_evt_continental
	}
	picture = {
		trigger = {
			is_ocean = yes
		}
		picture = GFX_evt_ocean
	}
	picture = {
		trigger = {
			is_tundra = yes
		}
		picture = GFX_evt_tundra
	}
	picture = {
		trigger = {
			is_arctic = yes
		}
		picture = GFX_evt_arctic
	}
	picture = {
		trigger = {
			is_gaia = yes
		}
		picture = GFX_evt_gaia
	}
	picture = {
		trigger = {
			is_nuked = yes
		}
		picture = GFX_evt_tomb_world
	}
	show_sound = event_administrative_work
	is_triggered_only = yes
	location = this

	trigger = {
		has_planet_flag = terraform_blocker_flag
		NOT = {
			any_deposit = {
				NOT = { is_same_value = From }
				is_deposit_type = d_terraforming_blocker
			}
		}
	}

	immediate = {
		remove_planet_flag = terraform_blocker_flag
	}

	option = {
		name = terra.30.a
		owner = {
			switch = {
				trigger = has_technology
				tech_climate_restoration = {
					add_monthly_resource_mult = {
						resource = society_research
						value = @tier5researchreward
						min = @tier5researchmin
						max = @tier5researchmax
					}
				}
				tech_ecological_adaptation = {
					add_tech_option_or_research_effect = {
   						TECH = tech_climate_restoration
   						PROGRESS = 0.2
   						CATEGORY = society_research
					}
				}
				tech_terrestrial_sculpting = {
					add_tech_option_or_research_effect = {
   						TECH = tech_ecological_adaptation
   						PROGRESS = 0.4
   						CATEGORY = society_research
					}
				}
				default = {
					add_tech_option_or_research_effect = {
   						TECH = tech_terrestrial_sculpting
   						PROGRESS = 0.8
   						CATEGORY = society_research
					}
				}
			}
		}
	}
}

country_event = {
	id = terra.40
	title = terra.40.name
	desc = terra.40.desc
	picture = GFX_evt_satellite_in_orbit
	location = from

	is_triggered_only = yes

	option = {
		name = terra.40.a
	}
	option = {
		name = terra.40.b
		From = { add_modifier = { modifier = intentionally_tidally_locked } }
		From = {
			set_planet_flag = tidally_locked_world
			if = {
				limit = { has_global_flag = planetarydiversity }
				change_pc = pc_tidallylocked
				add_deposit = d_nightside_mining_operations
				remove_modifier = intentionally_tidally_locked
				add_modifier = { modifier = tidal_locked2 }
				add_modifier = { modifier = intentionally_tidally_locked_2 }
			}
			else_if = {
				limit = { has_global_flag = has_new_frontiers_mod }
				change_pc = pc_tidallylocked
				remove_modifier = intentionally_tidally_locked
				add_modifier = { modifier = intentionally_tidally_locked_2 }
				if = {
					limit = {
						has_planet_flag = tundra_terraform
						has_planet_flag = arctic_terraform
						has_planet_flag = alpine_terraform
					}
					add_modifier = {
						modifier = "eyeball_world"
						days = -1
					}
					set_planet_entity = {
						picture = pc_eyeball
						entity = eyeball_planet_01_entity
					}
				}
				else = {
					add_modifier = {
						modifier = "meridiem_world"
						days = -1
					}
					set_planet_entity = {
						picture = pc_meridiem
						entity = meridiem_planet_01_entity
					}
				}
			}
		}
		custom_tooltip = terra.40.b.tooltip
	}
}