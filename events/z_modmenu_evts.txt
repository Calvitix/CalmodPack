namespace = z_modmenu
#_on_game_start installed flag
event = {
	id = z_modmenu.10
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		set_global_flag = z_modmenu_installed
		every_country = {
			limit = { is_ai = no }
			country_event = { id = z_modmenu.12  days = 2 }
		}
	}
}
###_万用初始化
country_event = {
	id = z_modmenu.101
	hide_window = yes
	fire_only_once = yes
	trigger = { is_ai = no }
	mean_time_to_happen = { days = 13 }

	immediate = {
		if = {
			limit = { NOT = { has_global_flag = z_modmenu_installed } }
			set_global_flag = z_modmenu_installed
			every_country = {
				limit = { is_ai = no }
				country_event = { id = z_modmenu.12  days = 1 }
			}
		}
	}
}

#_测试
country_event = {
	id = z_modmenu.11
	title = z_modmenu.11.name
	desc = z_modmenu.11.desc
	picture = GFX_evt_z_modmenu
	is_triggered_only = yes
	
	#_unemploy
	option = {
		name = z_modmenu_test_1
		trigger = {
			any_owned_pop = { is_unemployed = yes }
		}
		hidden_effect = {
			every_owned_pop = { limit = { is_unemployed = yes } unemploy_pop = yes }
			country_event = { id = z_modmenu.11 }
		}
	}
	#_去掉分类
	option = {
		name = z_modmenu_test_2
		trigger = {
			any_owned_pop = { is_unemployed = yes }
		}
		hidden_effect = {
			every_owned_pop = { limit = { is_unemployed = yes } clear_pop_category = yes }
			country_event = { id = z_modmenu.11 }
		}
	}
	#_改物种
	option = {
		name = z_modmenu_test_3
		trigger = {
			any_owned_pop = { is_unemployed = yes }
		}
		hidden_effect = {
			every_owned_pop = {
				limit = { is_unemployed = yes }
				modify_species = {
					species = this
					add_trait = trait_cybernetic
					add_traits_at_start_of_list = yes
					remove_trait = trait_cybernetic
					change_scoped_species = yes # change only this pop's species
				}
			}
			country_event = { id = z_modmenu.11 }
		}
	}
	#_强制检测阵营
	option = {
		name = z_modmenu_test_4
		trigger = {
			any_owned_pop = { is_unemployed = yes }
		}
		hidden_effect = {
			every_owned_pop = { limit = { is_unemployed = yes } force_faction_evaluation = yes }
			country_event = { id = z_modmenu.11 }
		}
	}
	#_kill and restore
	option = {
		name = z_modmenu_test_5
		trigger = {
			any_owned_pop = { is_unemployed = yes }
		}
		hidden_effect = {
			every_owned_pop = {
				limit = { is_unemployed = yes }
				save_event_target_as = z_refresh_pop
				species = { save_event_target_as = z_refresh_species }
				planet = {
					create_pop = {
						species = z_refresh_species
						ethos = z_refresh_pop
					}
				}
			}
			country_event = { id = z_modmenu.11 }
		}
	}
	#_创建test物体
	option = {
		name = z_modmenu_test_6
		hidden_effect = {
			capital_scope = {
				create_ambient_object = {
					type = z_testing_object
					location = this
					duration = 7
					
					use_3d_location = yes
					base_angle_towards = star
					entity_face_object = star
					entity_offset = { min = 0 max = 0 }
					entity_offset_height = { min = 10 max = 10 }
					entity_scale_to_size = yes
					scale = 2.0
				}
			}
			country_event = { id = z_modmenu.11 }
		}
	}
	
	option = {
		name = z_modmenu_exit
	}
}
	




	
	
	
#_提示-无尽整合菜单按钮
country_event = {
	id = z_modmenu.12
	title = z_modmenu_start_title
	desc = z_modmenu_start_title_desc
	picture = GFX_evt_z_modmenu_restoration
	is_triggered_only = yes
	
	immediate = {
		#if = {
		#	limit = { has_global_flag = z_framework_overwrite }
		#	begin_event_chain = { event_chain = z_chain_main target = this }	#_开启检视事件链
		#}
		set_global_flag = z_framework_core #_预开启框架
	}
	after = {
		hidden_effect = {
			if = {
				limit = { has_global_flag = z_framework_core }
				#_开局选项
				set_country_flag = z_fw1_start_monument
				remove_country_flag = z_fw1_start_preparation
				country_event = { id = z_fw1_misc.1 }	#_开局事件
			}
		}
	}
	###_无尽整合环境
	#_确定
	option = {
		name = z_modmenu.12.a1
		trigger = {
			has_global_flag = z_framework_overwrite
		}
	}
	###_非无尽整合环境
	#_确定-开启框架
	option = {
		name = z_modmenu.12.a3
		custom_tooltip = z_modmenu.12.a3.tooltip
		trigger = {
			NOT = { has_global_flag = z_framework_overwrite }
		}
	}
	#_确定-不开启框架
	option = {
		name = z_modmenu.12.a2
		custom_tooltip = z_modmenu.12.a2.tooltip
		trigger = {
			NOT = { has_global_flag = z_framework_overwrite }
		}
		hidden_effect = {
			remove_global_flag = z_framework_core
		}
	}
	#_确定-不开启框架并锁定设置按钮
	option = {
		name = z_modmenu.12.a4
		custom_tooltip = z_modmenu.12.a4.tooltip
		trigger = {
			NOT = { has_global_flag = z_framework_overwrite }
		}
		hidden_effect = {
			remove_global_flag = z_framework_core
			set_global_flag = z_framework_disabled
		}
	}
}
country_event = {
	id = z_modmenu.121
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		remove_global_flag = z_framework_disabled
		country_event = { id = z_modmenu.12 }
	}
}


#_modmenu
country_event = {
	id = z_modmenu.1
	title = z_modmenu.1.name
	#desc = "none"
	#picture = GFX_evt_z_modmenu
	is_triggered_only = yes
	trigger = { NOT = { has_country_flag = z_modmenu_opened } }
	
	diplomatic = yes
	custom_gui = "z_modmenu_window"
}


#_modmenu-framework
#_country_flag	[z_fw_last_cheater]上一个作弊者
country_event = {
	id = z_modmenu.13
	title = z_modmenu.13.name
	desc = z_modmenu.13.desc
	picture = GFX_evt_z_modmenu
	is_triggered_only = yes
	
	immediate = { z_mm_lock_framework = yes }
	after = { z_mm_unlock_framework = yes }
	
	#_无尽frameworks on
	option = {
		name = z_modmenu.13.c1
		custom_tooltip = z_modmenu.13.c1.tooltip
		trigger = {
			has_global_flag = z_framework_core
		}
		hidden_effect = {
			remove_global_flag = z_framework_core
			country_event = { id = z_modmenu.13 }
		}
	}
	#_无尽frameworks off
	option = {
		name = z_modmenu.13.c2
		custom_tooltip = z_modmenu.13.c2.tooltip
		trigger = {
			NOT = { has_global_flag = z_framework_core }
		}
		hidden_effect = {
			set_global_flag = z_framework_core
			country_event = { id = z_modmenu.13 }
		}
	}
	#_开局科技
	option = {
		name = z_modmenu.13.c3
		custom_tooltip = z_modmenu.13.c3.tooltip
		trigger = {
			has_global_flag = z_framework_core	#_启用框架
		}
		hidden_effect = {
			z_fw_eft_start_tech = yes
			country_event = { id = z_modmenu.13 }
		}
	}

	#_cheat on
	option = {
		name = z_modmenu.13.a1
		trigger = {
			has_relic = z_fw_r_celestial_orrey
		}
		hidden_effect = {
			remove_relic = z_fw_r_celestial_orrey
			remove_country_flag = z_fw_r_celestial_orrey_activited	#_debug 清除开启flag
			country_event = { id = z_modmenu.13 }
		}
	}
	#_cheat off
	option = {
		name = z_modmenu.13.a2
		trigger = {
			NOT = { has_relic = z_fw_r_celestial_orrey }
		}
		hidden_effect = {
			add_country_flag = z_fw_last_cheater		#_上一个打开cheat menu的
			add_relic = z_fw_r_celestial_orrey
			country_event = { id = z_modmenu.13 }
			every_country = {#_清除last flag
				limit = { NOT = { is_country = root } }
				remove_country_flag = z_fw_last_cheater
			}
			every_country = {
				limit = {
					is_ai = no
					NOT = { is_country = root }
				}
				country_event = { id = z_modmenu.131 }
			}
		}
	}
	
	#_星辰大海的渴望
	option = {
		name = z_modmenu.13.b1
		trigger = {
			NOT = { has_relic = z_fw_r_monument }
		}
		hidden_effect = {
			add_relic = z_fw_r_monument
			country_event = { id = z_modmenu.13 }
		}
	}
	#_星辰大海的渴望点数+3
	option = {
		name = z_modmenu.13.b2
		trigger = {
			has_relic = z_fw_r_celestial_orrey
		}
		hidden_effect = {
			change_variable = { which = z_fw_desire_point_var value = 3 }
			country_event = { id = z_modmenu.13 }
		}
	}
	#_星辰大海的渴望点数+30
	option = {
		name = z_modmenu.13.b3
		trigger = {
			has_relic = z_fw_r_celestial_orrey
		}
		hidden_effect = {
			change_variable = { which = z_fw_desire_point_var value = 30 }
			country_event = { id = z_modmenu.13 }
		}
	}
	
	#_IS difficulty
	#option = {
	#	name = z_modmenu_sp_enemy
	#	trigger = {
	#		has_global_flag = z_tl_installed
	#	}
	#	hidden_effect = {
	#		country_event = {
	#			id = z_sp_enemy.1
	#		}
	#	}
	#}
	
	option = {
		name = z_modmenu_exit
	}
}

#_modmenu-framework-cheat inform
country_event = {
	id = z_modmenu.131
	title = z_modmenu.131.name
	desc = z_modmenu.131.desc
	picture = GFX_evt_z_modmenu_no_mod
	is_triggered_only = yes
	immediate = {
		random_country = {
			limit = { has_country_flag = z_fw_last_cheater }
			save_event_target_as = z_fw_tgt_country_last_cheater
		}
	}
	option = {
		name = z_fw_evt_terrible
	}
}