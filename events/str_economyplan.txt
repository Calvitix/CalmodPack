# STARNET AI File
#
# Merge with STARNET AI OK  16/05/2021
#
namespace = str_economy_plan

event = {
    id = str_economy_plan.1
    is_triggered_only = yes
    fire_only_once = no
    hide_window = yes
    immediate = {
		every_country = {
			limit = {
				is_ai = yes
				or = {
					is_country_type = default
					is_country_type = awakened_fallen_empire
				}
		}
				#log = "str_economy_plan for [This.GetName]"
				country_event = { id = str_economy_plan.2 random = 100 days = 1 } 
				#country_event = { id = str_planet_spec.2 random = 100 days = 1 } 
		}
	}
}

country_event = {
    id = str_economy_plan.2
    is_triggered_only = yes
    fire_only_once = no
    hide_window = yes
        immediate = {
			remove_country_flag = str_has_room_to_grow
			remove_country_flag = str_has_designated_factory_switch
			remove_country_flag = str_has_designated_foundry_switch
			remove_country_flag = str_has_designated_good_factory_switch
			remove_country_flag = str_has_designated_good_foundry_switch
			remove_country_flag = str_has_misplaced_factory
			remove_country_flag = str_has_misplaced_foundry
			remove_country_flag = str_consumer_goods_margin
			remove_country_flag = str_deleted_extra_shipyard
			remove_country_flag = str_deleted_extra_anchorage
			set_timed_country_flag = {
				flag = str_reconsider_plans
				days = 70
			}

			if = {
				limit = {
					or = {
					count_owned_starbase = {
						count >= 7
						limit = { has_starbase_module = shipyard }
					}
					and = {
						max_naval_capacity < 600
						count_owned_starbase = {
							count >= 5
							limit = { has_starbase_module = shipyard }
						}
					}
					and = {
						max_naval_capacity < 200
						count_owned_starbase = {
							count >= 4
							limit = { has_starbase_module = shipyard }
						}
					}
					}
				}
				every_owned_starbase = {
					if = {
						limit = { 
						has_starbase_module = shipyard 
						owner = { not = { has_country_flag = str_deleted_extra_shipyard } }
					}
					owner = { set_country_flag = str_deleted_extra_shipyard }
					remove_starbase_module = { module = shipyard }
					remove_starbase_module = { module = shipyard }
					remove_starbase_module = { module = shipyard }
					remove_starbase_module = { module = shipyard }
					remove_starbase_module = { module = shipyard }
					remove_starbase_module = { module = shipyard }
					remove_starbase_building = { building = fleet_academy }
					}
				}
			}

			if = {
				limit = {
					or = {
					count_owned_starbase = {
						count <= 1
						limit = { has_starbase_module = shipyard }
					}
					and = {
						max_naval_capacity > 200
						count_owned_starbase = {
							count <= 2
							limit = { has_starbase_module = shipyard }
						}
					}
					}
				}
				every_owned_starbase = {
					if = {
						limit = { 
						has_starbase_module = anchorage 
						owner = { not = { has_country_flag = str_deleted_extra_anchorage } }
					}
					owner = { set_country_flag = str_deleted_extra_anchorage }
					remove_starbase_module = { module = anchorage }
					remove_starbase_module = { module = anchorage }
					remove_starbase_module = { module = anchorage }
					remove_starbase_module = { module = anchorage }
					remove_starbase_module = { module = anchorage }
					remove_starbase_module = { module = anchorage }
					remove_starbase_building = { building = naval_logistics_office }
					}
				}
			}

			if = {
				limit = {
					years_passed > 2
					not = { has_country_flag = str_capital_starbase_cleared }
				}
				set_country_flag =  str_capital_starbase_cleared 
				capital_scope = {
					starbase = {
						remove_starbase_module = { module = trading_hub	}
						remove_starbase_module = { module = solar_panel_network	}
					}
				}
			}

			if = {
				limit = {
					years_passed < 40
				}
				set_country_flag = str_has_room_to_grow
			}

			if = {
				limit= {is_ai = yes  
				or = { 
					years_passed < @str_years_of_guaranteed_truce
					and = { years_passed < @str_years_of_extended_truce scared_of_neighbour = no 
						resource_stockpile_compare = {
						resource = alloys
						value < 1000 } } 
					and = { has_global_flag = str_friendship_flag years_passed < 14 } } } 
				set_timed_country_flag = {
					flag = str_disable_corvettes
					days = 450
				}
			}



			if = {
				limit = {
					years_passed > 5
				}


				every_owned_planet = {
					if = {
						limit = {
							free_building_slots = 0
							free_amenities < -14
						}
						if = {
							limit = {
								num_buildings = { type = building_bureaucratic_1 value > 0 }
								free_district_slots = 0
							}
							remove_building = building_bureaucratic_1
						}
						else_if = {
							limit = {
								num_buildings = { type = building_research_lab_1 value > 0 }
								free_district_slots = 0
							}
							remove_building = building_research_lab_1
						}
					}

					if = {
						limit = {
							has_designation = col_factory
							owner = { not = { has_country_flag = str_has_designated_good_factory_switch } }
						}
						if = {
							limit = {
								num_buildings = { type = building_factory_1 value = 0 }
								num_buildings = { type = building_factory_2 value = 0 }
							}
							set_timed_planet_flag = {
								flag = str_good_factory_switching_candidate
								days = 200
							}
							owner = { set_country_flag = str_has_designated_good_factory_switch } 
							owner = { set_country_flag = str_has_designated_factory_switch } 
						}
						if = {
							limit = { owner = { not = { has_country_flag = str_has_designated_factory_switch } } }
							set_timed_planet_flag = {
								flag = str_factory_switching_candidate
								days = 200
							} 
							owner = { set_country_flag = str_has_designated_factory_switch } 

						}
					}
					

					if = {
						limit = {
							has_designation = col_foundry
							owner = { not = { has_country_flag = str_has_designated_good_foundry_switch } }
						}
						if = {
							limit = { owner = { resource_income_compare = { resource = consumer_goods value > 10 } } }
							owner = { set_country_flag = str_consumer_goods_margin }
						}
						if = {
							limit = {
								num_buildings = { type = building_foundry_1 value = 0 }
								num_buildings = { type = building_foundry_2 value = 0 }
							}
							set_timed_planet_flag = {
								flag = str_good_foundry_switching_candidate
								days = 200
							}
							owner = { set_country_flag = str_has_designated_good_foundry_switch } 
							owner = { set_country_flag = str_has_designated_foundry_switch } 
						}
						if = {
							limit = { owner = { not = { has_country_flag = str_has_designated_foundry_switch } } }
							set_timed_planet_flag = {
								flag = str_foundry_switching_candidate
								days = 200
							} 
							owner = { set_country_flag = str_has_designated_foundry_switch } 

						}
					}

					if = {
						limit = {
							has_designation = col_foundry
							or = {
								num_buildings = { type = building_factory_1 value = 1 }
								num_buildings = { type = building_factory_2 value = 1 }
							} 
						}
						if = {
							limit = {
								owner = { has_country_flag = str_has_misplaced_factory }
							}
							remove_building = building_factory_1
							remove_building = building_factory_2
						}
						else = {
							owner = { set_country_flag = str_has_misplaced_factory }
						}
					}

					
					if = {
						limit = {
							has_designation = col_factory
							or = {
								num_buildings = { type = building_foundry_1 value = 1 }
								num_buildings = { type = building_foundry_2 value = 1 }
							} 
						}
						if = {
							limit = {
								owner = { has_country_flag = str_has_misplaced_foundry }
							}
							remove_building = building_foundry_1
							remove_building = building_foundry_2
						}
						else = {
							owner = { set_country_flag = str_has_misplaced_foundry }
						}
					}


					if = {
						limit = { any_owned_pop = {
							is_sapient = yes
							planet = { habitability = { who = prev value > 0.65 } }
							is_robot_pop = no
							} }
						set_planet_flag = str_good_habitability
						remove_planet_flag = str_acceptable_habitability
						remove_planet_flag = str_bad_habitability
						if = {
							limit = { or ={ free_jobs > 2 free_district_slots > 0 } }
							owner = { set_country_flag = str_has_room_to_grow }
						}
					}
					else_if = {
						limit = { any_owned_pop = {
							or = { is_sapient = yes is_robot_pop = yes }
							planet = { habitability = { who = prev value > 0.35 } }
							} }
							remove_planet_flag = str_good_habitability
							set_planet_flag = str_acceptable_habitability
							remove_planet_flag = str_bad_habitability
							if = {
								limit = { or ={ free_jobs > 2 free_district_slots > 0 } }
								owner = { set_country_flag = str_has_room_to_grow }
							}
					}
					else = {
						remove_planet_flag = str_good_habitability
						remove_planet_flag = str_acceptable_habitability
						set_planet_flag = str_bad_habitability
						remove_district = district_industrial
						if = {
							limit = {
								num_pops = 3
							}
							set_timed_planet_flag = {
								flag = str_get_out_of_here
								days = 360
							}
						}
					}
				
					if = {
						limit = {
							or = { has_designation = col_foundry has_designation = col_factory is_capital = yes }
							or = {
							num_free_districts = {
								type = district_industrial
								value < 1
							} 
							free_jobs > 1
							and = {
								owner = { resource_stockpile_compare = {
									resource = minerals
									value > 400
									} }
								free_jobs > 0
								}
							}
						}
						if = {
							limit = { num_districts = {type = district_farming value > 1 }
								owner = {
									resource_stockpile_compare = {
										resource = food
										value > 900
									}
									resource_income_compare = {
										resource = food
										value > 20
									}	
								not = {
									has_country_flag = str_country_just_removed_food
								} }
							}
							remove_district = district_farming
							owner = {
								set_timed_country_flag = {
									flag = str_country_just_removed_food
									days = 300
								}
							}
							set_timed_planet_flag = {
								flag = str_just_removed_food_district
								days = 500
							}
						}
						else_if = { 
								limit = { num_districts = {type = district_mining value > 1 }
									owner = {
										resource_stockpile_compare = {
											resource = minerals
											value > 2000
										}
										resource_income_compare = {
											resource = minerals
											value > 70
										}
									not = {
										has_country_flag = str_country_just_removed_minerals
									} }
								}
								remove_district = district_mining
								set_timed_planet_flag = {
									flag = str_just_removed_mineral_district
									days = 600
								}
								owner = { set_timed_country_flag = {
									flag = str_country_just_removed_minerals
									days = 600
								} }
						}
						
						else_if = {
								limit = { num_districts = {type = district_generator value > 1 }
									owner = {
										resource_stockpile_compare = {
											resource = energy
											value > 800
										}
										resource_income_compare = {
											resource = energy
											value > 30
										}	
									not = {
										has_country_flag = str_country_just_removed_energy
									}
									}
								}
								remove_district = district_generator
								set_timed_planet_flag = {
									flag = str_just_removed_energy_district
									days = 600
								}
								owner = { set_timed_country_flag = {
									flag = str_country_just_removed_energy
									days = 600
								} }

						}
					}
					
					if = {
						limit = { num_districts = {type = district_farming value > 1 }
							not = {
								has_designation = col_farming
							}
							owner = {
								resource_stockpile_compare = {
									resource = food
									value > 900
								}
								resource_income_compare = {
									resource = food
									value > 35
								}	
							not = {
								has_country_flag = str_country_just_removed_food
							} }
						}
						remove_district = district_farming
						owner = {
							set_timed_country_flag = {
								flag = str_country_just_removed_food
								days = 300
							}
						}
						set_timed_planet_flag = {
							flag = str_just_removed_food_district
							days = 500
						}
					}
					if = {
						limit = { 
								has_designation = col_farming
							owner = {
								resource_stockpile_compare = {
									resource = food
									value > 950
								}
								resource_income_compare = {
									resource = food
									value > 65
								}	
							not = {
								has_country_flag = str_country_just_removed_food
							} }
						}
						remove_district = district_farming
						owner = {
							set_timed_country_flag = {
								flag = str_country_just_removed_food
								days = 300
							}
						}
						set_timed_planet_flag = {
							flag = str_just_removed_food_district
							days = 500
						}
					}
					if = {
						limit = {
							free_jobs > 5
							free_amenities < -9
							planet_stability < 40
							free_building_slots > 0 
						}
						remove_district = district_farming
						remove_district = district_mining
						remove_district = district_generator
					}

				}
				if = {
					limit = { 
						is_ai = yes
						or = {
							has_deficit = minerals
							str_minerals_crisis_2 = yes
						}
					}
					every_owned_planet = {
						remove_district = district_industrial
					}
				}
					
			}
			if = {
				limit = {
					is_ai = yes
					is_gestalt = yes
				}
				every_owned_planet = {
					if = {
						limit = {
							or = { free_amenities > 7 free_amenities < -1 }
						}
						planet_event = {
							id = str_planet_audit.1
						}
					}
					if = {
						limit = {
							free_amenities > 13
						}
						planet_event = {
							id = str_planet_audit.1
						}
						planet_event = {
							id = str_planet_audit.1
						}
					}
				}
			}
	}
}
