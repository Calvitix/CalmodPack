#
# Space Exploitation
#
# Modif by Calvitix 
#
# energy -> power_plant_
# mine -> minerals_mine
# alloy -> alloys_mine
# foundry -> alloys_foundry
# research -> research_lab
# motes -> motes_mine
# gases -> gases_well
# crystals -> crystal_mine
#
# prefix for all flags : flg_
# Last update : 29/10/2021
#
namespace = spaceexploitAI

event = {
	id = spaceexploitAI.0


	hide_window = yes
	is_triggered_only = yes
	immediate = {
		#Calvitix Log Setting
		#set_global_flag = exploitation_logging
		remove_global_flag = exploitation_logging
		every_country = {
			limit = {
				is_country_type = default
			}
			export_to_exploit_variables = yes
		}
	}
}


event = {
	id = spaceexploitAI.10000
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		every_country = {
			limit = {
				is_country_type = default
			}
			export_to_exploit_variables = yes
		}
		every_country = {
			limit = {
				NOT = { has_country_flag = recent_exploit_apply }
				is_country_type = default
				OR = {
					AND = {
						is_ai = yes
						NOT = { has_global_flag = flg_exploit_ai_off }
					}
					AND = {
						is_ai = no
						OR = {
							has_exploit_queue = yes
							has_country_flag = flg_exploit_automation
						}
					}
				}
				any_planet_within_border = {
					can_build_exploit_colony = yes
					OR = {
						uninhabitable_regular_planet = yes
						is_planet_class = pc_gas_giant
						is_planet_class = pc_asteroid
						is_planet_class = pc_ice_asteroid
						is_planet_class = pc_rare_crystal_asteroid
					}
					NOT = {
						has_modifier = colonized_planet
					}
				}
			}
			#log = "Space Exploit check AI.10001 for country ok, start exploit_apply_queue for [This.GetName]"			
			fire_on_action = { on_action = exploit_apply_queue }
		}
	}
}

country_event = {
	id = spaceexploitAI.10001
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		log = "Space Exploit check AI.10001 for [This.GetName]"			
		#calculate_allowed_exploits = yes
		#export_to_exploit_variables = yes
		random_list = {
			10 = {
				country_event = { id = spaceexploitAI.101 days = 2 }
				if = {
					limit = {
						has_global_flag = exploitation_logging
					}
					log = "2 day delay Apply Exploit Queue for [This.GetName]"
				}
			}
			10 = {
				country_event = { id = spaceexploitAI.101 days = 32 }
				if = {
					limit = {
						has_global_flag = exploitation_logging
					}
					log = "32 day delay Apply Exploit Queue for [This.GetName]"
				}
			}
			10 = {
				country_event = { id = spaceexploitAI.101 days = 62 }
				if = {
					limit = {
						has_global_flag = exploitation_logging
					}
					log = "62 day delay Apply Exploit Queue for [This.GetName]"
				}
			}
			10 = {
				country_event = { id = spaceexploitAI.101 days = 92 }
				if = {
					limit = {
						has_global_flag = exploitation_logging
					}
					log = "92 day delay Apply Exploit Queue for [This.GetName]"
				}
			}
			10 = {
				country_event = { id = spaceexploitAI.101 days = 122 }
				if = {
					limit = {
						has_global_flag = exploitation_logging
					}
					log = "122 day delay Apply Exploit Queue for [This.GetName]"
				}
			}
			10 = {
				country_event = { id = spaceexploitAI.101 days = 152 }
				if = {
					limit = {
						has_global_flag = exploitation_logging
					}
					log = "152 day delay Apply Exploit Queue for [This.GetName]"
				}
			}
			10 = {
				country_event = { id = spaceexploitAI.101 days = 182 }
				if = {
					limit = {
						has_global_flag = exploitation_logging
					}
					log = "182 day delay Apply Exploit Queue for [This.GetName]"
				}
			}
			10 = {
				country_event = { id = spaceexploitAI.101 days = 212 }
				if = {
					limit = {
						has_global_flag = exploitation_logging
					}
					log = "212 day delay Apply Exploit Queue for [This.GetName]"
				}
			}
			10 = {
				country_event = { id = spaceexploitAI.101 days = 242 }
				if = {
					limit = {
						has_global_flag = exploitation_logging
					}
					log = "242 day delay Apply Exploit Queue for [This.GetName]"
				}
			}
			10 = {
				country_event = { id = spaceexploitAI.101 days = 272 }
				if = {
					limit = {
						has_global_flag = exploitation_logging
					}
					log = "272 day delay Apply Exploit Queue for [This.GetName]"
				}
			}
			10 = {
				country_event = { id = spaceexploitAI.101 days = 302 }
				if = {
					limit = {
						has_global_flag = exploitation_logging
					}
					log = "302 day delay Apply Exploit Queue for [This.GetName]"
				}
			}
			10 = {
				country_event = { id = spaceexploitAI.101 days = 332 }
				if = {
					limit = {
						has_global_flag = exploitation_logging
					}
					log = "332 day delay Apply Exploit Queue for [This.GetName]"
				}
			}
		}
	}
}

country_event = {
	id = spaceexploitAI.101
	hide_window = yes
	is_triggered_only = yes
	location = ROOT
	
	immediate = {
		log = "Space Exploit check AI.0 before calculate_allowed_exploits for AI : [This.GetName]"					
		if = {
			limit = {
				is_ai = yes
			}
			if = {
				limit = {
					has_global_flag = exploitation_logging
				}
				log = "Space Exploit check AI.0 before calculate_allowed_exploits for AI : [This.GetName]"					
			}			
			calculate_allowed_exploits = yes
		}
		if = {
			limit = {
				has_global_flag = exploitation_logging
			}
			log = "Space Exploit check AI.0 before export_to_exploi for [This.GetName]"					
		}

		export_to_exploit_variables = yes
		if = {
			limit = {
				has_global_flag = exploitation_logging
			}
			log = "Space Exploit check AI.0 for country done, start spaceexploitAI.1 for [This.GetName]"					
		}
								
		country_event = { id = spaceexploitAI.1 days = 1 }
	}
	after = {
	}
}
country_event = {
	id = spaceexploitAI.1
	hide_window = yes
	is_triggered_only = yes
	location = ROOT
	
	immediate = {
		if = {
			limit = {
				has_global_flag = exploitation_logging
			}
			log = "spaceexploitAI.1 : Launch mark_systems_develop for [This.GetName]"
		}		
		mark_systems_develop = yes
	}
	after = {
	}
}

country_event = {
	id = spaceexploitAI.2
	hide_window = yes
	is_triggered_only = yes
	location = ROOT
	
	immediate = {
		every_system_within_border = {
			limit = {
				has_star_flag = flg_exploit_colonize_target
			}			
			#system_event = { id = spaceexploitAI.4 days = 3 }			
		}
		every_planet_within_border = {
			limit = {
				has_planet_flag = flg_exploit_colonize_target
			}
			planet_event = { id = spaceexploitAI.3 days = 5 }
			}
		}
	after = {
	}
}

planet_event = {
	id = spaceexploitAI.3
	hide_window = yes
	is_triggered_only = yes
	location = ROOT
	
	immediate = {
		#log = "spaceexploitAI.3 for [ROOT.GetName]"
		colonize_exploit_planet = yes
	}
	after = {
	}
}

system_event = {
	id = spaceexploitAI.4
	hide_window = yes
	is_triggered_only = yes
	location = ROOT
	
	immediate = {
		if = {
			limit = {
				owner = { has_country_flag = flg_exploit_automation }
				check_variable = { which = var_exploitation_centers value > 0 }
			}
			if = {
				limit = {
					owner = {
						OR = {
							NOT = { has_country_flag = flg_exploit_spread }
							has_country_flag = flg_exploit_spread_failed
						}
					}
				}
				
			}
			else_if = {
				limit = {
					owner = { has_country_flag = flg_exploit_spread }
				}
				
			}
		}
		else_if = {
			limit = {
				owner = { NOT = { has_country_flag = flg_exploit_automation } }
				has_exploit_queue = yes
			}
			#log = "spaceexploitAI.4, launching has_exploit_queue for [This.GetName]"
			if = {
				limit = {
					owner = {
						OR = {
							NOT = { has_country_flag = flg_exploit_spread }
							has_country_flag = flg_exploit_spread_failed
						}
					}
				}
				
			}
			else_if = {
				limit = {
					owner = { has_country_flag = flg_exploit_spread }
				}
				
			}
		
		}
	}
	#after = {
	#}
}