namespace = fix_ai_actions

country_event = {
	id = fix_ai_actions.0
	hide_window = yes
	is_triggered_only = yes
	fire_only_once = yes

	trigger = {
		is_ai = no
	}

	immediate = {
		country_event = {
			#start menu
			id = fix_ai_actions.2
		}
	}
}

#default settings
event = {
	id = fix_ai_actions.1
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		set_global_flag = ai_gateway_construction_flag
		set_global_flag = ai_xeno_compatibility_flag
		set_global_flag = ai_habitat_construction_flag
		set_global_flag = ai_unemployment_flag
		set_global_flag = ai_corvette_destroyer_spam_flag
		set_global_flag = ai_population_count_control_flag
		set_global_flag = modifier_optimisation_flag
		remove_global_flag = ai_and_player_flag
	}
}

#menu
country_event = {
	id = fix_ai_actions.2
	title = "fix_ai_actions.1.name"
	desc = "fix_ai_actions.1.desc"
	picture = GFX_evt_ai_planet
	show_sound = event_mystic_reveal
	hide_window = no

	is_triggered_only = yes

	trigger = {
		is_ai = no
	}

	option = { 
		name = "fix_ai_actions.1.a" custom_tooltip = "fix_ai_actions_event.3.custom_tooltip.a"
		allow = {
			hidden_trigger = {
				has_global_flag = ai_gateway_construction_flag
			}
		}
		remove_global_flag = ai_gateway_construction_flag
		hidden_effect = {
			country_event = {
				id = fix_ai_actions.2
			}
		}
	}
	option = { 
		name = "fix_ai_actions.1.b" custom_tooltip = "fix_ai_actions_event.3.custom_tooltip.b"
		allow = {
			hidden_trigger = {
				has_global_flag = ai_xeno_compatibility_flag
			}
		}
		remove_global_flag = ai_xeno_compatibility_flag
		hidden_effect = {
			country_event = {
				id = fix_ai_actions.2
			}
		}
	}
	option = { 
		name = "fix_ai_actions.1.c" custom_tooltip = "fix_ai_actions_event.3.custom_tooltip.c"
		allow = {
			hidden_trigger = {
				has_global_flag = ai_habitat_construction_flag
			}
		}
		remove_global_flag = ai_habitat_construction_flag
		hidden_effect = {
			country_event = {
				id = fix_ai_actions.2
			}
		}
	}
	option = { 
		name = "fix_ai_actions.1.d" custom_tooltip = "fix_ai_actions_event.3.custom_tooltip.d"
		allow = {
			hidden_trigger = {
				has_global_flag = ai_unemployment_flag
			}
		}
		remove_global_flag = ai_unemployment_flag
		hidden_effect = {
			country_event = {
				id = fix_ai_actions.2
			}
		}
	}
	option = { 
		name = "fix_ai_actions.1.e" custom_tooltip = "fix_ai_actions_event.3.custom_tooltip.e"
		allow = {
			hidden_trigger = {
				has_global_flag = ai_corvette_destroyer_spam_flag
			}
		}
		remove_global_flag = ai_corvette_destroyer_spam_flag
		hidden_effect = {
			country_event = {
				id = fix_ai_actions.2
			}
		}
	}
	option = { 
		name = "fix_ai_actions.1.f" custom_tooltip = "fix_ai_actions_event.3.custom_tooltip.g"
		allow = {
			hidden_trigger = {
				has_global_flag = ai_population_count_control_flag
			}
		}
		remove_global_flag = ai_population_count_control_flag
		hidden_effect = {
			country_event = {
				id = fix_ai_actions.2
			}
		}
	}
	option = { 
		name = "fix_ai_actions.1.g" custom_tooltip = "fix_ai_actions_event.3.custom_tooltip.f"
		allow = {
			hidden_trigger = {
				has_global_flag = modifier_optimisation_flag
			}
		}
		remove_global_flag = modifier_optimisation_flag
		hidden_effect = {
			country_event = {
				id = fix_ai_actions.2
			}
		}
	}
	option = { 
		name = "fix_ai_actions.1.h" custom_tooltip = "fix_ai_actions_event.3.custom_tooltip.h"
		allow = {
			hidden_trigger = {
				NOT = {
					has_global_flag = ai_and_player_flag
				}
			}
		}
		set_global_flag = ai_and_player_flag
		hidden_effect = {
			country_event = {
				id = fix_ai_actions.2
			}
		}
	}
	option = { 
		name = "fix_ai_actions.1.i" #custom_tooltip = "fix_ai_actions_event.3.custom_tooltip.h"
	}
}

country_event = {
	id = fix_ai_actions.3
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		if = {
			limit = {
				NOT = {
					has_global_flag = ai_and_player_flag
				}
			}
			is_ai = yes
		}
		has_global_flag = ai_unemployment_flag
	}

	immediate = {
		random_owned_planet = {
			limit = {
				colony_age > 44
				num_assigned_jobs = {
					job = unemployed
					value >= 1
				}
			}
			random_owned_pop = {
				limit = {
					is_unemployed = yes
					NOT = {
						has_job = bio_trophy
					}
				}
				prevprev = {
					random_owned_planet = {
						limit = {
							is_colony = yes
							free_jobs >= 1
						}
						resettle_pop = {
							pop = prevprev
							planet = this
						}
					}
				}
			}
		}
	}
}

country_event = {
	id = fix_ai_actions.4
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		if = {
			limit = {
				NOT = {
					has_global_flag = ai_and_player_flag
				}
			}
			is_ai = yes
		}
		has_global_flag = ai_corvette_destroyer_spam_flag
	}

	immediate = {
		random_owned_fleet = {
			limit = {
				count_owned_ship = {
					limit = {
						is_ship_size = corvette
					}
					count > 60
				}
			}
			if = {
				limit = { 
					prev = {
						has_technology = tech_destroyers
					}
				}
				random_owned_ship = {
					limit = {
						is_ship_size = corvette
					}
					delete_ship = this
				}
				random_owned_ship = {
					limit = {
						is_ship_size = corvette
					}
					delete_ship = this
				}
				create_ship = {
					name = random
					random_existing_design = destroyer
				}
			}
		}
		random_owned_fleet = {
			limit = {
				count_owned_ship = {
					limit = {
						is_ship_size = destroyer
					}
					count > 30
				}
			}
			if = {
				limit = { 
					prev = {
						has_technology = tech_cruisers
					}
				}
				random_owned_ship = {
					limit = {
						is_ship_size = destroyer
					}
					delete_ship = this
				}
				random_owned_ship = {
					limit = {
						is_ship_size = destroyer
					}
					delete_ship = this
				}
				create_ship = {
					name = random
					random_existing_design = cruiser
				}
			}
		}
	}
}
country_event = {
	id = fix_ai_actions.5
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		is_ai = yes
	}

	immediate = {
		add_modifier = {
			modifier = micro_marketing
		}
	}
}
country_event = {
	id = fix_ai_actions.6
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		if = {
			limit = {
				NOT = {
					has_global_flag = ai_and_player_flag
				}
			}
			is_ai = yes
		}
		has_global_flag = ai_population_count_control_flag
	}

	immediate = {
		every_owned_planet = {
			limit = {
				is_colony = yes
				num_pops > 29 #9
			}
			remove_modifier = planet_pop_conversion_count_1
			remove_modifier = planet_pop_conversion_count_2
			remove_modifier = planet_pop_conversion_count_3
			remove_modifier = planet_pop_conversion_count_4
			remove_modifier = planet_pop_conversion_count_5
		if = {
			limit = {
					num_pops > 29 #9
					num_pops < 40 #20
			}
			add_modifier = {
					modifier = planet_pop_conversion_count_1 days = 360
			}
				remove_modifier = planet_pop_conversion_count_2
				remove_modifier = planet_pop_conversion_count_3
				remove_modifier = planet_pop_conversion_count_4
				remove_modifier = planet_pop_conversion_count_5
		}
			else_if = {
				limit = {
					num_pops > 39
					num_pops < 60
				}
				add_modifier = {
					modifier = planet_pop_conversion_count_2 days = 360
				}
				remove_modifier = planet_pop_conversion_count_1
				remove_modifier = planet_pop_conversion_count_3
				remove_modifier = planet_pop_conversion_count_4
				remove_modifier = planet_pop_conversion_count_5
			}
			else_if = {
				limit = {
					num_pops > 59
					num_pops < 70
				}
				add_modifier = {
					modifier = planet_pop_conversion_count_3 days = 360
				}
				remove_modifier = planet_pop_conversion_count_1
				remove_modifier = planet_pop_conversion_count_2
				remove_modifier = planet_pop_conversion_count_4
				remove_modifier = planet_pop_conversion_count_5
			}
			else_if = {
				limit = {
					num_pops > 69
					num_pops < 80
				}
				add_modifier = {
					modifier = planet_pop_conversion_count_4 days = 360
				}
				remove_modifier = planet_pop_conversion_count_1
				remove_modifier = planet_pop_conversion_count_2
				remove_modifier = planet_pop_conversion_count_3
				remove_modifier = planet_pop_conversion_count_5
			}
			else_if = {
				limit = {
					num_pops > 79
				}
				add_modifier = {
					modifier = planet_pop_conversion_count_5 days = 360
				}
			}
			else = {
				remove_modifier = planet_pop_conversion_count_1
				remove_modifier = planet_pop_conversion_count_2
				remove_modifier = planet_pop_conversion_count_3
				remove_modifier = planet_pop_conversion_count_4
				remove_modifier = planet_pop_conversion_count_5
			}
		}
		remove_modifier = country_pop_conversion_count_1
		remove_modifier = country_pop_conversion_count_2
		remove_modifier = country_pop_conversion_count_3
		remove_modifier = country_pop_conversion_count_4
		remove_modifier = country_pop_conversion_count_5
		if = {
			limit = {
				num_pops > 199
				num_pops < 400
			}
			add_modifier = {
				modifier = country_pop_conversion_count_1 days = 360
			}
			remove_modifier = country_pop_conversion_count_2
			remove_modifier = country_pop_conversion_count_3
			remove_modifier = country_pop_conversion_count_4
			remove_modifier = country_pop_conversion_count_5
		}
		else_if = {
			limit = {
				num_pops > 399
				num_pops < 600
			}
			add_modifier = {
				modifier = country_pop_conversion_count_2 days = 360
			}
			remove_modifier = country_pop_conversion_count_1
			remove_modifier = country_pop_conversion_count_3
			remove_modifier = country_pop_conversion_count_4
			remove_modifier = country_pop_conversion_count_5
		}
		else_if = {
			limit = {
				num_pops > 599
				num_pops < 800
			}
			add_modifier = {
				modifier = country_pop_conversion_count_3 days = 360
			}
			remove_modifier = country_pop_conversion_count_1
			remove_modifier = country_pop_conversion_count_2
			remove_modifier = country_pop_conversion_count_4
			remove_modifier = country_pop_conversion_count_5
		}
		else_if = {
			limit = {
				num_pops > 799
				num_pops < 1000
			}
			add_modifier = {
				modifier = country_pop_conversion_count_4 days = 360
			}
			remove_modifier = country_pop_conversion_count_1
			remove_modifier = country_pop_conversion_count_2
			remove_modifier = country_pop_conversion_count_3
			remove_modifier = country_pop_conversion_count_5
		}
		else_if = {
			limit = {
				num_pops > 999
			}
			add_modifier = {
				modifier = country_pop_conversion_count_5 days = 360
			}
			remove_modifier = country_pop_conversion_count_1
			remove_modifier = country_pop_conversion_count_2
			remove_modifier = country_pop_conversion_count_3
			remove_modifier = country_pop_conversion_count_4
		}
		else = {
			remove_modifier = country_pop_conversion_count_1
			remove_modifier = country_pop_conversion_count_2
			remove_modifier = country_pop_conversion_count_3
			remove_modifier = country_pop_conversion_count_4
			remove_modifier = country_pop_conversion_count_5
		}
	}
}

country_event = {
	id = fix_ai_actions.7
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_global_flag = modifier_optimisation_flag
	}

	immediate = {
		set_update_modifiers_batch = begin
		country_event = {
			id = fix_ai_actions.8
			days = 28
		}
	}
}

country_event = {
	id = fix_ai_actions.8
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		set_update_modifiers_batch = end
	}
}