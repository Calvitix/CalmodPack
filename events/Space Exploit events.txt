#
# Space Exploitation, Merge 07/05/2021
#
# Modif by Calvitix 
#
# energy -> power_plant_
# mine -> minerals_mine
# alloy -> alloys_mine
# foundry -> alloys_foundry
# research -> research_lab
# motes -> motes_mine
# gases -> gases_well
# crystals -> crystal_mine
#
#
#
#
namespace = spaceexploit

planet_event = {
	id = spaceexploit.10000
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		solar_system = {
			random_system_planet = {
				#log = "Random_system : [This.GetName]"
				limit = {
					has_planet_flag = flg_exploit_center
				}
				if = {
					limit = {
						has_global_flag = exploitation_logging
					}
					#log = "Adding Minor Colony on [ROOT.GetName] for [This.GetName]"
					#log = "Minor Colony Count [This.var_small_colony_count] on [This.GetName]"
					#log = "Exploit Constructions [This.var_exploitation_trade] on [This.GetName]"
				}
			}
		}
		set_variable = { which = var_exploitation_size value = 0 }
		colonize_exploit_planet = yes
		if = {
			limit = {
				has_global_flag = exploitation_logging
			}
			#log = "Size starting [This.var_exploitation_size] on [This.GetName]"
		}
		solar_system = {
			random_system_planet = {
				limit = {
					has_planet_flag = flg_exploit_center
				}
				if = {
					limit = {
						has_global_flag = exploitation_logging
					}
					#log = "Minor Colony Count [This.var_small_colony_count] on [This.GetName]"
					#log = "Exploit Constructions [This.var_exploitation_trade] on [This.GetName]"
				}
			}
		}
	}
}
#Mineral Mine
planet_event = {
	id = spaceexploit.1
	hide_window = yes
	is_triggered_only = yes
	location = ROOT
	
	immediate = {
		#log = "Launch exploit_minerals_mine_loop on [This.GetName]"
		exploit_minerals_mine_loop = yes
	}
}
planet_event = {
	id = spaceexploit.102
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		#log = "Launch build_exploit_minerals_mine on [This.GetName]"
		build_exploit_minerals_mine = yes
	}
}

#Power Plant
planet_event = {
	id = spaceexploit.2
	hide_window = yes
	is_triggered_only = yes
	location = ROOT
	
	immediate = {
		#log = "Launch exploit_power_plant_loop on [This.GetName]"
		exploit_power_plant_loop = yes
	}
}
planet_event = {
	id = spaceexploit.202
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		#log = "Launch build_exploit_power_plant on [This.GetName]"
		build_exploit_power_plant = yes
	}
}


#Alloy Casting
planet_event = {
	id = spaceexploit.4
	hide_window = yes
	is_triggered_only = yes
	location = ROOT
	
	immediate = {
		#log = "Launch exploit_alloys_foundry_loop on [This.GetName]"
		exploit_alloys_foundry_loop = yes
	}
}
planet_event = {
	id = spaceexploit.402
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		#log = "Launch exploit_alloys_foundry_loop on [This.GetName]"
		build_exploit_alloys_foundry = yes
	}
}

#Alloy Mining
planet_event = {
	id = spaceexploit.5
	hide_window = yes
	is_triggered_only = yes
	location = ROOT
	
	immediate = {
		#log = "Launch exploit_alloys_mine_loop on [This.GetName]"
		exploit_alloys_mine_loop = yes
	}
}
planet_event = {
	id = spaceexploit.502
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		#log = "Launch build_alloys_mine_loop on [This.GetName]"
		build_exploit_alloys_mine = yes
	}
}

#Volatile Motes
planet_event = {
	id = spaceexploit.7
	hide_window = yes
	is_triggered_only = yes
	location = ROOT
	
	immediate = {
		#log = "Launch exploit_motes_mine_loop on [This.GetName]"
		exploit_motes_mine_loop = yes
	}
}
planet_event = {
	id = spaceexploit.702
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		#log = "Launch build_exploit_alloys_foundry_loop on [This.GetName]"
		build_exploit_motes_mine = yes
	}
}
#Rare Crystals
planet_event = {
	id = spaceexploit.8
	hide_window = yes
	is_triggered_only = yes
	location = ROOT
	
	immediate = {
		#log = "Launch exploit_crystals_mine_loop on [This.GetName]"
		exploit_crystals_mine_loop = yes
	}
}
planet_event = {
	id = spaceexploit.802
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		#log = "Launch build_exploit_crystals_mine on [This.GetName]"
		build_exploit_crystals_mine = yes
	}
}
#Exotic Gases
planet_event = {
	id = spaceexploit.9
	hide_window = yes
	is_triggered_only = yes
	location = ROOT
	
	immediate = {
		#log = "Launch exploit_gases_well_loop on [This.GetName]"
		exploit_gases_well_loop = yes
	}
}
planet_event = {
	id = spaceexploit.902
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		#log = "Launch build_exploit_gases_well on [This.GetName]"
		build_exploit_gases_well = yes
	}
}
#Lava Refinery
planet_event = {
	id = spaceexploit.10
	hide_window = yes
	is_triggered_only = yes
	location = ROOT
	
	immediate = {
		#log = "Launch exploit_lava_refinery_loop on [This.GetName]"
		exploit_lava_refinery_loop = yes
	}
}
planet_event = {
	id = spaceexploit.1002
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		#log = "Launch build_exploit_lava_refinery on [This.GetName]"
		build_exploit_lava_refinery = yes
	}
}

#Research Labs
planet_event = {
	id = spaceexploit.12
	hide_window = yes
	is_triggered_only = yes
	location = ROOT
	
	immediate = {
		#log = "Launch exploit_research_lab_loop on [This.GetName]"
		exploit_research_lab_loop = yes
	}
}
planet_event = {
	id = spaceexploit.1202
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		#log = "Launch build_exploit_research_lab on [This.GetName]"
		build_exploit_research_lab = yes
	}
}	


planet_event = {
	id = spaceexploit.13
	hide_window = yes
	is_triggered_only = yes
	location = ROOT
	
	immediate = {
		planet_event = { id = spaceexploit.30 days = @YearConstructionTime }
		planet_event = { id = spaceexploit.1301 days = @YearConstructionTime }
		ROOT = { change_variable = { which = var_exploitation_size value = -3 } }
	}
}

planet_event = {
	id = spaceexploit.1301
	hide_window = yes
	is_triggered_only = yes
	location = ROOT
	
	immediate = {
		remove_modifier = building_thing
		add_modifier = { modifier = terraforming_candidate }
	}
}



planet_event = {
	id = spaceexploit.30
	hide_window = yes
	is_triggered_only = yes
	location = ROOT
	
	immediate = {
		solar_system = {
		#log = "spaceexploit.30 for [This.GetName]"
			if = {
				limit = {
					any_system_planet = {
						has_planet_flag = flg_exploit_center
					}
				}
				#log = "spaceexploit.30 has flg_exploit_center for [This.GetName]"
				every_system_planet = {
					limit = {
						has_planet_flag = flg_exploit_center
						owner = {
							is_gestalt = no
						}
					}
					#log = "spaceexploit.30 add_deposit space_ex_construction_1 for [This.GetName]"
					add_deposit = space_ex_construction_1
					
					change_variable = { which = var_exploitation_trade value = 1 }
				}
				every_system_planet = {
					limit = {
						has_planet_flag = flg_exploit_center
						owner = {
							is_gestalt = yes
						}
					}
					#log = "spaceexploit.30 add_deposit space_ex_construction_1 for [This.GetName]"
					add_deposit = space_ex_construction_1
					change_variable = { which = var_exploitation_trade value = 1 }
				}
			}
		}
	}
}

country_event = {
	id = spaceexploit.32
	#title = "spaceexploit.1.name"
	#desc = "spaceexploit.1.desc"
	#picture = GFX_evt_asteroid_approaching_planet
	is_triggered_only = yes
	#location = FROM
	#auto_opens = no
	hide_window = yes
	
	immediate = {
	}
	#option = {
	#	name = "Next project!"
	#}
}

country_event = {
	id = spaceexploit.33
	#title = "spaceexploit.2.name"
	#desc = "spaceexploit.2.desc"
	#picture = GFX_evt_asteroid_approaching_planet
	is_triggered_only = yes
	#location = FROM
	#auto_opens = no
	hide_window = yes
	
	immediate = {
	}
	#option = {
	#	name = "Next project!"
	#}
}

country_event = {
	id = spaceexploit.35
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		every_owned_planet = {
			limit = {
				has_planet_flag = flg_exploit_center
			}
			if = {
				limit = {
					has_global_flag = exploitation_logging
				}
				#log = "Minor Colony Count [This.var_small_colony_count] on [This.GetName]"
				#log = "Exploit Constructions [This.var_exploitation_trade] on [This.GetName]"
			}
			set_variable = { which = var_colonytemp value = small_colony_count }
			set_variable = { which = var_exploittemp value = var_exploitation_trade }
			every_deposit = {
				if = {
					limit = {
						OR = {
							is_deposit_type = d_trade_value_1
							is_deposit_type = space_ex_construction_1
							is_deposit_type = d_small_colonies
						}
					}
					remove_deposit = yes
				}
			}
		}
	}
	after = {
		every_owned_planet = {
			limit = {
				has_planet_flag = flg_exploit_center
			}
			if = {
				limit = {
					has_global_flag = exploitation_logging
				}
				#log = "Minor Colony Count [This.var_colonytemp] on [This.GetName]"
				#log = "Exploit Constructions [This.var_exploittemp] on [This.GetName]"
			}
			while = {
				count = 10000
				limit = {
					check_variable = { which = var_exploittemp value > 0 }
				}
				change_variable = { which = var_exploittemp value = -1 }
				add_deposit = space_ex_construction_1
			}
			while = {
				count = 50
				limit = {
					check_variable = { which = var_colonytemp value > 0 }
				}
				change_variable = { which = var_colonytemp value = -1 }
				add_deposit = d_small_colonies
			}
		}
	}
}

event = {
	id = spaceexploit.36
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		set_global_flag = flg_exploit_speed_difficulty
		every_country = {
			limit = {
				is_country_type = default
			}
			country_event = { id = spaceexploit.37 days = 2 }
		}
	}
}

country_event = {
	id = spaceexploit.37
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		reset_queue_variables = yes #Calvitix addition
		#log = "Exploit Colonies for [This.GetName]"
		game_start_colonies = yes
	}
	
	after = {
		every_planet_within_border = {
			limit = {
				has_modifier = colonized_planet
				has_deposit_for = shipclass_mining_station
			}
			#log = "Created Mining Station on [This.GetName] for [PREV.GetName]"
			create_mining_station = {
				owner = ROOT
			}
		}
		every_planet_within_border = {
			limit = {
				has_modifier = colonized_planet
				has_deposit_for = shipclass_research_station
			}
			#log = "Created Research Station on [This.GetName] for [PREV.GetName]"
			create_research_station = {
				owner = ROOT
			}
		}
	}
}

country_event = {
	id = spaceexploit.40
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				OR = {
					last_increased_tech = tech_starbase_3
					last_increased_tech = tech_starbase_4
					last_increased_tech = tech_starbase_5
					last_increased_tech = tech_habitat_1
					last_increased_tech = tech_habitat_2
					last_increased_tech = tech_habitat_3
				}
			}
			every_planet_within_border = {
				limit = {
					has_modifier = colonized_planet
				}
				random_list = {
					10 = {
						planet_event = { id = spaceexploit.42 days = 10 }
					}
					10 = {
						planet_event = { id = spaceexploit.42 days = 40 }
					}
					10 = {
						planet_event = { id = spaceexploit.42 days = 70 }
					}
					10 = {
						planet_event = { id = spaceexploit.42 days = 100 }
					}
				}
			}
		} 
	}
}

event = {
	id = spaceexploit.41
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		every_country = {
			if = {
				limit = {
					NOT = {
						has_country_flag = has_arcology_project_exploit
					}
					has_ascension_perk = ap_arcology_project
				}
				set_country_flag = has_arcology_project_exploit
				every_planet_within_border = {
					limit = {
						has_modifier = colonized_planet
					}
					random_list = {
						10 = {
							planet_event = { id = spaceexploit.42 days = 10 }
						}
						10 = {
							planet_event = { id = spaceexploit.42 days = 40 }
						}
						10 = {
							planet_event = { id = spaceexploit.42 days = 70 }
						}
						10 = {
							planet_event = { id = spaceexploit.42 days = 100 }
						}
					}
				}
			}
			if = {
				limit = {
					NOT = {
						has_country_flag = has_voidborn_exploit
					}
					has_ascension_perk = ap_voidborn
				}
				set_country_flag = has_voidborn_exploit
				every_planet_within_border = {
					limit = {
						has_modifier = colonized_planet
					}
					random_list = {
						10 = {
							planet_event = { id = spaceexploit.42 days = 10 }
						}
						10 = {
							planet_event = { id = spaceexploit.42 days = 40 }
						}
						10 = {
							planet_event = { id = spaceexploit.42 days = 70 }
						}
						10 = {
							planet_event = { id = spaceexploit.42 days = 100 }
						}
					}
				}
			}
		}
	}
	after = {
		
	}
}

planet_event = {
	id = spaceexploit.42
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		#log = "spaceexploit.42 upgrade_exploit_size for [This.GetName]"
		upgrade_exploit_size = yes
	}
	after = {
		ai_colony_switch = yes	
	}
}

planet_event = {
	id = spaceexploit.43
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		#log = "spaceexploit.43 check var_exploitation_size for [This.GetName]"
		if = {
			limit = {
				check_variable = { which = var_exploitation_size value = 0 }
			}
			set_variable = { which = var_exploitation_size value = 0 }
		}
		if = {
			limit = {
				solar_system = {
					space_owner = {
						has_technology = tech_starbase_3
					}
				}
			}
			change_variable = { which = var_exploitation_size value = 1 }
		}
		if = {
			limit = {
				solar_system = {
					space_owner = {
						has_technology = tech_starbase_4
					}
				}
			}
			change_variable = { which = var_exploitation_size value = 1 }
		}
		if = {
			limit = {
				solar_system = {
					space_owner = {
						has_technology = tech_starbase_5
					}
				}
			}
			change_variable = { which = var_exploitation_size value = 1 }
		}
		if = {
			limit = {
				solar_system = {
					space_owner = {
						has_technology = tech_habitat_1
					}
				}
			}
			change_variable = { which = var_exploitation_size value = 1 }
		}
		if = {
			limit = {
				solar_system = {
					space_owner = {
						has_technology = tech_habitat_2
					}
				}
			}
			change_variable = { which = var_exploitation_size value = 1 }
		}
		if = {
			limit = {
				solar_system = {
					space_owner = {
						has_technology = tech_habitat_3
					}
				}
			}
			change_variable = { which = var_exploitation_size value = 1 }
		}
		if = {
			limit = {
				solar_system = {
					space_owner = {
						has_ascension_perk = ap_voidborn
					}
				}
			}
			change_variable = { which = var_exploitation_size value = 1 }
		}
		if = {
			limit = {
				solar_system = {
					space_owner = {
						has_ascension_perk = ap_arcology_project
					}
				}
			}
			change_variable = { which = var_exploitation_size value = 1 }
		}
	}
	after = {
		if = {
			limit = {
				NOT = {
					has_modifier = building_thing
				}
				OR = {
					solar_system = {
						space_owner = {
							is_ai = yes
							has_country_flag = flg_exploit_automation
						}
					}
				}
			}
			ai_colony_switch = yes
		}
	}
}